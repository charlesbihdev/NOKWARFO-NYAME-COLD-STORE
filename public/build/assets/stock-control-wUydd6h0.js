import{j as e,u as T,r as f,a as R}from"./app-CSpnaBUl.js";import{b as $,A as ie}from"./app-layout-CWV4g8tt.js";import{D as re}from"./DateRangePicker-Yu_zSytu.js";import{F as v}from"./createLucideIcon-QiRiosVH.js";import{D as E,b as F,c as L,d as I,e as U}from"./dialog-ap17z-JQ.js";import{I as k}from"./index-DLSs-Ycf.js";import{L as h}from"./label-CAW60j__.js";import{I as A}from"./InputError-C5Wd-y-S.js";import{T as z}from"./textarea-D_KU1JBi.js";import{C as H,a as M,b as P,c as Q}from"./card-DpGhQ29Y.js";import{T as B,a as G,b as q,c as x,d as J,e as o}from"./table-B3iHrbkm.js";import{S as de}from"./square-pen-DHcuQoCl.js";import{T as ce}from"./trash-2-B4NIfq5M.js";import"./index-Bc7ey0Ni.js";import"./index-B3_FoTJa.js";function oe({isOpen:r,onClose:n,selectedProduct:t,data:s,setData:a,errors:d,processing:m,onSubmit:g}){return e.jsx(E,{open:r,onOpenChange:n,children:e.jsxs(F,{className:"max-w-2xl",children:[e.jsx(L,{children:e.jsxs(I,{children:["Add Stock for ",t==null?void 0:t.name]})}),e.jsxs("form",{onSubmit:g,className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"quantity",className:"text-right",children:"Quantity *"}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(k,{id:"quantity",type:"text",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:s.quantity,onChange:u=>a("quantity",u.target.value),required:!0}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Format: 5C2L = 5 cartons + 2 lines, 10C = 10 cartons, 15L = 15 lines, or just a number"}),d.quantity&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:d.quantity})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"notes",className:"text-right",children:"Notes"}),e.jsx("div",{className:"col-span-3",children:e.jsx(k,{id:"notes",placeholder:"Optional notes",value:s.notes,onChange:u=>a("notes",u.target.value)})})]}),e.jsx(v,{type:"submit",disabled:m,children:"Add Stock"})]})]})})}function ue({isOpen:r,onClose:n,selectedProduct:t,errors:s={}}){const{data:a,setData:d,post:m,processing:g,reset:u,clearErrors:j}=T({product_id:"",physical_count:"",notes:"",current_system_stock:""});f.useEffect(()=>{r&&t&&(u(),j(),d({product_id:t.id,physical_count:"",notes:"",current_system_stock:t.current_stock_display||"0"}))},[r,t,u,j]);function S(l){l.preventDefault(),m(route("stock-control.adjust"),{onSuccess:()=>{u(),j(),n()},preserveScroll:!0,preserveState:!1})}function i(){u(),j(),n()}return t?e.jsx(E,{open:r,onOpenChange:i,children:e.jsxs(F,{className:"max-w-2xl",children:[e.jsx(L,{children:e.jsxs(I,{children:["Stock Adjustment for ",t.name]})}),e.jsxs("form",{onSubmit:S,className:"grid gap-4 py-4",children:[e.jsx("input",{type:"hidden",name:"product_id",value:a.product_id}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"current_stock",className:"text-right",children:"Current System Stock"}),e.jsx("div",{className:"col-span-3",children:e.jsx(k,{id:"current_stock",type:"text",value:a.current_system_stock||"0",disabled:!0,className:"bg-gray-100"})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"physical_count",className:"text-right",children:"Physical Count *"}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(k,{id:"physical_count",type:"text",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:a.physical_count,onChange:l=>d("physical_count",l.target.value),required:!0}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Enter the actual count from your physical inventory"}),s.physical_count&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:s.physical_count})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"notes",className:"text-right",children:"Notes"}),e.jsx("div",{className:"col-span-3",children:e.jsx(k,{id:"notes",placeholder:"Additional details about this adjustment",value:a.notes,onChange:l=>d("notes",l.target.value)})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{className:"text-right",children:"Info"}),e.jsx("div",{className:"col-span-3",children:e.jsx("div",{className:"p-3 bg-blue-50 rounded border",children:e.jsx("div",{className:"text-sm text-gray-600",children:"Enter the physical count and reason. The system will automatically calculate the adjustment needed."})})})]}),e.jsx(v,{type:"submit",disabled:g,children:g?"Processing...":"Apply Adjustment"})]})]})}):null}function xe({isOpen:r,onClose:n,stockMovement:t,products:s,errors:a={}}){const{data:d,setData:m,put:g,processing:u,reset:j}=T({product_id:"",quantity:"",notes:""});f.useEffect(()=>{var i;if(t){const l=(b,N)=>{if(N<=1)return b.toString();const p=Math.floor(b/N),y=b%N;return p>0&&y>0?`${p}C${y}L`:p>0?`${p}C`:y>0?`${y}L`:"0"};m({product_id:t.product_id||"",quantity:l(t.quantity,((i=t.product)==null?void 0:i.lines_per_carton)||1),notes:t.notes||""})}},[t]);function S(){t&&g(route("stock-control.update",t.id),{onSuccess:()=>{j(),n()},preserveScroll:!0,preserveState:!0,only:["stock_movements","stock_activity_summary","errors","flash"]})}return!t||t.type!=="received"?null:e.jsx(E,{open:r,onOpenChange:n,children:e.jsxs(F,{className:"max-h-[90vh] max-w-2xl overflow-y-auto",children:[e.jsxs(L,{children:[e.jsx(I,{children:"Edit Stock Movement"}),e.jsx(U,{children:"Update the stock movement information. All fields marked with * are required."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-product-id",children:"Product *"}),e.jsxs("select",{id:"edit-product-id",value:d.product_id,onChange:i=>m("product_id",i.target.value),required:!0,className:"w-full rounded border px-3 py-2",children:[e.jsx("option",{value:"",children:"Select product"}),s.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),a.product_id&&e.jsx(A,{message:a.product_id,className:"mt-1"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-type",children:"Type"}),e.jsx("div",{className:"w-full rounded border px-3 py-2 bg-gray-50 text-gray-700",children:"Stock In (Received)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-quantity",children:"Quantity * (Format: 5C2L for 5 cartons + 2 lines)"}),e.jsx(k,{id:"edit-quantity",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:d.quantity,onChange:i=>m("quantity",i.target.value),required:!0}),a.quantity&&e.jsx(A,{message:a.quantity,className:"mt-1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(z,{id:"edit-notes",placeholder:"Additional notes about this stock movement",value:d.notes,onChange:i=>m("notes",i.target.value),rows:3}),a.notes&&e.jsx(A,{message:a.notes,className:"mt-1"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:n,children:"Cancel"}),e.jsx(v,{onClick:S,disabled:u,children:u?"Updating...":"Update Stock Movement"})]})]})]})})}function me({isOpen:r,onClose:n,stockMovement:t,products:s,errors:a={}}){const{data:d,setData:m,put:g,processing:u,reset:j}=T({product_id:"",type:"",quantity:"",notes:""});f.useEffect(()=>{var l;if(t){const b=(N,p)=>{if(p<=1)return N.toString();const y=Math.floor(N/p),_=N%p;return y>0&&_>0?`${y}C${_}L`:y>0?`${y}C`:_>0?`${_}L`:"0"};m({product_id:t.product_id||"",type:t.type||"",quantity:b(t.quantity,((l=t.product)==null?void 0:l.lines_per_carton)||1),notes:t.notes||""})}},[t]);function S(){t&&g(route("stock-control.updateAdjustment",t.id),{onSuccess:()=>{j(),n()},preserveScroll:!0,preserveState:!0,only:["stock_movements","stock_activity_summary","errors","flash"]})}if(!t||!["adjustment_in","adjustment_out"].includes(t.type))return null;const i=t.type==="adjustment_in";return e.jsx(E,{open:r,onOpenChange:n,children:e.jsxs(F,{className:"max-h-[90vh] max-w-2xl overflow-y-auto",children:[e.jsxs(L,{children:[e.jsx(I,{children:"Edit Stock Adjustment"}),e.jsxs(U,{children:["Update the ",i?"stock addition":"stock reduction"," information. All fields marked with * are required."]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-product-id",children:"Product *"}),e.jsxs("select",{id:"edit-product-id",value:d.product_id,onChange:l=>m("product_id",l.target.value),required:!0,className:"w-full rounded border px-3 py-2",children:[e.jsx("option",{value:"",children:"Select product"}),s.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),a.product_id&&e.jsx(A,{message:a.product_id,className:"mt-1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-type",children:"Adjustment Type"}),e.jsx("div",{className:`w-full rounded border px-3 py-2 font-medium ${i?"bg-blue-50 text-blue-700 border-blue-200":"bg-yellow-50 text-yellow-700 border-yellow-200"}`,children:i?"➕ Stock Addition":"➖ Stock Reduction"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-quantity",children:"Quantity * (Format: 5C2L for 5 cartons + 2 lines)"}),e.jsx(k,{id:"edit-quantity",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:d.quantity,onChange:l=>m("quantity",l.target.value),required:!0}),a.quantity&&e.jsx(A,{message:a.quantity,className:"mt-1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(z,{id:"edit-notes",placeholder:"Reason for this stock adjustment",value:d.notes,onChange:l=>m("notes",l.target.value),rows:3}),a.notes&&e.jsx(A,{message:a.notes,className:"mt-1"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:n,children:"Cancel"}),e.jsx(v,{onClick:S,disabled:u,children:u?"Updating...":"Update Adjustment"})]})]})]})})}function he({products:r,onAddStock:n,onAdjustStock:t}){return e.jsxs(H,{children:[e.jsx(M,{children:e.jsx(P,{children:"Product Inventoryyyy"})}),e.jsx(Q,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left font-medium",children:"Product Name"}),e.jsx("th",{className:"p-2 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:r.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2 font-medium",children:s.name}),e.jsx("td",{className:"p-2 text-center",children:e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>n(s),children:"Add Stock"}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>t(s),children:"Stock Adjustment"})]})})]},s.id))})]})})})]})}function je({stock_activity_summary:r,start_date:n,end_date:t}){return e.jsxs("div",{className:"mb-8 rounded-lg bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx($,{className:"h-6 w-6 text-gray-500"}),e.jsxs("h2",{className:"text-2xl font-bold",children:["Product Stock Activity Summary"," ",n&&t?e.jsxs(e.Fragment,{children:["(",new Date(n).toLocaleDateString()," - ",new Date(t).toLocaleDateString(),")"]}):"(Today)"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(B,{children:[e.jsx(G,{children:e.jsxs(q,{children:[e.jsx(x,{children:"Product"}),e.jsx(x,{children:"Stock Received today"}),e.jsx(x,{children:"Previous Stock"}),e.jsx(x,{className:"bg-blue-50",children:"Total Available"}),e.jsx(x,{children:"Cash Sales"}),e.jsx(x,{children:"Credit Sales"}),e.jsx(x,{children:"Partial Sales"}),e.jsx(x,{className:"bg-green-50",children:"Total Sales"}),e.jsx(x,{children:"Corrections"}),e.jsx(x,{className:"bg-yellow-50",children:"Remaining Stock"})]})}),e.jsx(J,{children:r.length?r.map((s,a)=>e.jsxs(q,{children:[e.jsx(o,{className:"font-medium",children:s.product}),e.jsx(o,{className:"text-center",children:s.stock_received_today}),e.jsx(o,{className:"text-center",children:s.previous_stock}),e.jsx(o,{className:"bg-blue-50 text-center font-semibold",children:s.total_available}),e.jsx(o,{className:"text-center",children:s.cash_sales}),e.jsx(o,{className:"text-center",children:s.credit_sales}),e.jsx(o,{className:"text-center",children:s.partial_sales}),e.jsx(o,{className:"bg-green-50 text-center font-semibold",children:s.total_sales}),e.jsx(o,{className:"text-center",children:e.jsx("span",{className:`text-sm ${s.corrections.includes("Added")?"text-green-600 font-medium":s.corrections.includes("Reduced")?"text-red-600 font-medium":"text-gray-500"}`,children:s.corrections})}),e.jsx(o,{className:"bg-yellow-50 text-center font-semibold",children:s.remaining_stock})]},s.product+a)):e.jsx(q,{children:e.jsx(o,{colSpan:10,className:"text-muted-foreground py-4 text-center",children:"No data for today."})})})]})}),e.jsxs("div",{className:"text-muted-foreground mt-3 flex flex-col gap-1 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block h-4 w-4 rounded-sm border border-blue-100 bg-blue-50"}),e.jsx("span",{children:"Total Available = Previous Stock + Stock Received + Adjustments"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block h-4 w-4 rounded-sm border border-green-100 bg-green-50"}),e.jsx("span",{children:"Total Sales = Cash Sales + Credit Sales + Partial Sales"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block h-4 w-4 rounded-sm border border-yellow-100 bg-yellow-50"}),e.jsx("span",{children:"Remaining Stock = Total Available - Total Sales"})]})]})]})}function pe({stock_movements:r,onDelete:n,onEdit:t}){return e.jsxs(H,{children:[e.jsx(M,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Stock Movements"]})}),e.jsx(Q,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(B,{children:[e.jsx(G,{children:e.jsxs(q,{children:[e.jsx(x,{children:"Product"}),e.jsx(x,{children:"Type"}),e.jsx(x,{children:"Quantity"}),e.jsx(x,{children:"Notes"}),e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(J,{children:r.map(s=>{var a;return e.jsxs(q,{className:s.type.includes("adjustment")?"bg-yellow-50":"bg-green-50",children:[e.jsx(o,{className:"font-medium",children:(a=s.product)==null?void 0:a.name}),e.jsx(o,{children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${s.type==="received"?"bg-green-100 text-green-800":s.type==="adjustment_in"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:s.type==="received"?"Stock In":s.type==="adjustment_in"?"Adjustment In":"Adjustment Out"})}),e.jsx(o,{className:`font-medium ${s.type==="adjustment_out"?"text-yellow-600":"text-green-600"}`,children:s.quantity_display}),e.jsx(o,{children:s.notes}),e.jsx(o,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(o,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>t(s),children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>n(s.id),children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Delete"]})]})})]},s.id)})})]})})})]})}function Ee({stock_movements:r=[],products:n=[],stock_activity_summary:t=[],date:s}){const[a,d]=f.useState(!1),[m,g]=f.useState(!1),[u,j]=f.useState(!1),[S,i]=f.useState(!1),[l,b]=f.useState(null),[N,p]=f.useState(null),{data:y,setData:_,post:K,processing:V,errors:O,reset:W}=T({product_id:"",quantity:"",notes:""}),[w,X]=f.useState(""),[D,Y]=f.useState(""),Z=[{title:"Stock Control",href:"/stock-control"}];function ee(c){b(c),_({product_id:c.id,quantity:"",notes:""}),d(!0)}function te(c){b(c),g(!0)}function se(c){c.preventDefault(),K(route("stock-control.store"),{onSuccess:()=>{W(),d(!1),b(null)},preserveScroll:!0,preserveState:!0,only:["products","stock_movements","stock_activity_summary","errors","flash"]})}function ae(c){confirm("Are you sure you want to delete this stock movement?")&&R.delete(route("stock-control.destroy",c),{preserveScroll:!0,preserveState:!0,only:["stock_movements","products","stock_activity_summary","flash"]})}function ne(c){p(c),c.type==="received"?(j(!0),i(!1)):["adjustment_in","adjustment_out"].includes(c.type)&&(i(!0),j(!1))}const le=(c,C)=>{C==="start"?X(c):C==="end"&&Y(c),(C==="start"&&D||C==="end"&&w)&&R.get(route("stock-control.index"),{start_date:C==="start"?c:w,end_date:C==="end"?c:D},{preserveState:!0,replace:!0})};return e.jsx(ie,{breadcrumbs:Z,children:e.jsxs("div",{className:"min-h-screen space-y-6 bg-gray-100 p-6",children:[e.jsx(re,{startDate:w,endDate:D,onChange:le}),e.jsx(je,{stock_activity_summary:t,start_date:w,end_date:D}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Inventory Management"})}),e.jsx(he,{products:n,onAddStock:ee,onAdjustStock:te}),e.jsx(oe,{isOpen:a,onClose:()=>d(!1),selectedProduct:l,data:y,setData:_,errors:O,processing:V,onSubmit:se}),e.jsx(ue,{isOpen:m,onClose:()=>g(!1),selectedProduct:l}),e.jsx(xe,{isOpen:u,onClose:()=>{j(!1),p(null)},stockMovement:N,products:n,errors:O}),e.jsx(me,{isOpen:S,onClose:()=>{i(!1),p(null)},stockMovement:N,products:n,errors:O}),e.jsx(pe,{stock_movements:r,onDelete:ae,onEdit:ne})]})})}export{Ee as default};
