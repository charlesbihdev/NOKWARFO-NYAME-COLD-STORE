import{j as e,u as q,r as v,a as E}from"./app-DUtXgMsJ.js";import{b as $,A as le}from"./app-layout-CfGcrLHe.js";import{I as N}from"./input-BogF8VYv.js";import{F as b}from"./createLucideIcon-BsyMmKAN.js";import{D as T,b as D,c as F,d as L,e as R}from"./dialog-B-hHNItd.js";import{L as u}from"./label-DoXehEub.js";import{I as C}from"./InputError-Cf5EZXwu.js";import{T as U}from"./textarea-tRTHnhE-.js";import{C as z,a as H,b as M,c as Q}from"./card-DCpXWH4X.js";import{T as B,a as G,b as A,c as m,d as J,e as o}from"./table-BYGLCm-c.js";import{S as ie}from"./square-pen-CwM-MZrZ.js";import{T as ne}from"./trash-2-E9HV4GyE.js";import"./index-lI6q_VJN.js";import"./index-CvWcqQt7.js";function re({isOpen:d,onClose:i,selectedProduct:t,data:s,setData:a,errors:r,processing:x,onSubmit:g}){return e.jsx(T,{open:d,onOpenChange:i,children:e.jsxs(D,{className:"max-w-2xl",children:[e.jsx(F,{children:e.jsxs(L,{children:["Add Stock for ",t==null?void 0:t.name]})}),e.jsxs("form",{onSubmit:g,className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"date",className:"text-right",children:"Date"}),e.jsx("div",{className:"col-span-3",children:e.jsx(N,{id:"date",type:"date",value:s.date||new Date().toISOString().split("T")[0],onChange:c=>a("date",c.target.value),required:!0})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"quantity",className:"text-right",children:"Quantity *"}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(N,{id:"quantity",type:"text",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:s.quantity,onChange:c=>a("quantity",c.target.value),required:!0}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Format: 5C2L = 5 cartons + 2 lines, 10C = 10 cartons, 15L = 15 lines, or just a number"}),r.quantity&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:r.quantity})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"notes",className:"text-right",children:"Notes"}),e.jsx("div",{className:"col-span-3",children:e.jsx(N,{id:"notes",placeholder:"Optional notes",value:s.notes,onChange:c=>a("notes",c.target.value)})})]}),e.jsx(b,{type:"submit",disabled:x,children:"Add Stock"})]})]})})}function de({isOpen:d,onClose:i,selectedProduct:t,errors:s={}}){const{data:a,setData:r,post:x,processing:g,reset:c,clearErrors:j}=q({product_id:"",date:new Date().toISOString().split("T")[0],available_stock_target:"",received_today_target:"",notes:"",current_system_stock:""});v.useEffect(()=>{d&&t&&(c(),j(),r({product_id:t.id,date:new Date().toISOString().split("T")[0],available_stock_target:"",received_today_target:"",notes:"",current_system_stock:t.current_stock_display||"0"}))},[d,t,c,j]);function _(l){l.preventDefault(),x(route("stock-control.adjust"),{onSuccess:()=>{c(),j(),i()},preserveScroll:!0,preserveState:!0,only:["products","stock_movements","stock_activity_summary","errors","flash"]})}function n(){c(),j(),i()}return t?e.jsx(T,{open:d,onOpenChange:n,children:e.jsxs(D,{className:"max-w-2xl",children:[e.jsx(F,{children:e.jsxs(L,{children:["Stock Adjustment for ",t.name]})}),e.jsxs("form",{onSubmit:_,className:"grid gap-4 py-4",children:[e.jsx("input",{type:"hidden",name:"product_id",value:a.product_id}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"date",className:"text-right",children:"Date"}),e.jsx("div",{className:"col-span-3",children:e.jsx(N,{id:"date",type:"date",value:a.date,onChange:l=>r("date",l.target.value),required:!0})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"available_stock_target",className:"text-right",children:"Set Available Stock (as of date)"}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(N,{id:"available_stock_target",type:"text",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:a.available_stock_target,onChange:l=>r("available_stock_target",l.target.value)}),s.available_stock_target&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:s.available_stock_target})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"received_today_target",className:"text-right",children:"Set Stock Received today (for date)"}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(N,{id:"received_today_target",type:"text",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:a.received_today_target,onChange:l=>r("received_today_target",l.target.value)}),s.received_today_target&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:s.received_today_target})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{htmlFor:"notes",className:"text-right",children:"Notes"}),e.jsx("div",{className:"col-span-3",children:e.jsx(N,{id:"notes",placeholder:"Additional details about this adjustment",value:a.notes,onChange:l=>r("notes",l.target.value)})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(u,{className:"text-right",children:"Info"}),e.jsx("div",{className:"col-span-3",children:e.jsx("div",{className:"p-3 bg-blue-50 rounded border",children:e.jsx("div",{className:"text-sm text-gray-600",children:"Fill any field you want to set for the selected date. The system will compute adjustments to sync to those targets."})})})]}),e.jsx(b,{type:"submit",disabled:g,children:g?"Processing...":"Apply Adjustment"})]})]})}):null}function ce({isOpen:d,onClose:i,stockMovement:t,products:s,errors:a={}}){const{data:r,setData:x,put:g,processing:c,reset:j}=q({product_id:"",quantity:"",notes:""});v.useEffect(()=>{var n;if(t){const l=(S,f)=>{if(f<=1)return S.toString();const p=Math.floor(S/f),y=S%f;return p>0&&y>0?`${p}C${y}L`:p>0?`${p}C`:y>0?`${y}L`:"0"};x({product_id:t.product_id||"",quantity:l(t.quantity,((n=t.product)==null?void 0:n.lines_per_carton)||1),notes:t.notes||""})}},[t]);function _(){t&&g(route("stock-control.update",t.id),{onSuccess:()=>{j(),i()},preserveScroll:!0,preserveState:!0,only:["stock_movements","stock_activity_summary","errors","flash"]})}return!t||t.type!=="received"?null:e.jsx(T,{open:d,onOpenChange:i,children:e.jsxs(D,{className:"max-h-[90vh] max-w-2xl overflow-y-auto",children:[e.jsxs(F,{children:[e.jsx(L,{children:"Edit Stock Movement"}),e.jsx(R,{children:"Update the stock movement information. All fields marked with * are required."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-product-id",children:"Product *"}),e.jsxs("select",{id:"edit-product-id",value:r.product_id,onChange:n=>x("product_id",n.target.value),required:!0,className:"w-full rounded border px-3 py-2",children:[e.jsx("option",{value:"",children:"Select product"}),s.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]}),a.product_id&&e.jsx(C,{message:a.product_id,className:"mt-1"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-type",children:"Type"}),e.jsx("div",{className:"w-full rounded border px-3 py-2 bg-gray-50 text-gray-700",children:"Stock In (Received)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-quantity",children:"Quantity * (Format: 5C2L for 5 cartons + 2 lines)"}),e.jsx(N,{id:"edit-quantity",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:r.quantity,onChange:n=>x("quantity",n.target.value),required:!0}),a.quantity&&e.jsx(C,{message:a.quantity,className:"mt-1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(U,{id:"edit-notes",placeholder:"Additional notes about this stock movement",value:r.notes,onChange:n=>x("notes",n.target.value),rows:3}),a.notes&&e.jsx(C,{message:a.notes,className:"mt-1"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(b,{type:"button",variant:"outline",onClick:i,children:"Cancel"}),e.jsx(b,{onClick:_,disabled:c,children:c?"Updating...":"Update Stock Movement"})]})]})]})})}function oe({isOpen:d,onClose:i,stockMovement:t,products:s,errors:a={}}){const{data:r,setData:x,put:g,processing:c,reset:j}=q({product_id:"",type:"",quantity:"",notes:""});v.useEffect(()=>{var l;if(t){const S=(f,p)=>{if(p<=1)return f.toString();const y=Math.floor(f/p),k=f%p;return y>0&&k>0?`${y}C${k}L`:y>0?`${y}C`:k>0?`${k}L`:"0"};x({product_id:t.product_id||"",type:t.type||"",quantity:S(t.quantity,((l=t.product)==null?void 0:l.lines_per_carton)||1),notes:t.notes||""})}},[t]);function _(){t&&g(route("stock-control.updateAdjustment",t.id),{onSuccess:()=>{j(),i()},preserveScroll:!0,preserveState:!0,only:["stock_movements","stock_activity_summary","errors","flash"]})}if(!t||!["adjustment_in","adjustment_out"].includes(t.type))return null;const n=t.type==="adjustment_in";return e.jsx(T,{open:d,onOpenChange:i,children:e.jsxs(D,{className:"max-h-[90vh] max-w-2xl overflow-y-auto",children:[e.jsxs(F,{children:[e.jsx(L,{children:"Edit Stock Adjustment"}),e.jsxs(R,{children:["Update the ",n?"stock addition":"stock reduction"," information. All fields marked with * are required."]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-product-id",children:"Product *"}),e.jsxs("select",{id:"edit-product-id",value:r.product_id,onChange:l=>x("product_id",l.target.value),required:!0,className:"w-full rounded border px-3 py-2",children:[e.jsx("option",{value:"",children:"Select product"}),s.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),a.product_id&&e.jsx(C,{message:a.product_id,className:"mt-1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-type",children:"Adjustment Type"}),e.jsx("div",{className:`w-full rounded border px-3 py-2 font-medium ${n?"bg-blue-50 text-blue-700 border-blue-200":"bg-yellow-50 text-yellow-700 border-yellow-200"}`,children:n?"➕ Stock Addition":"➖ Stock Reduction"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-quantity",children:"Quantity * (Format: 5C2L for 5 cartons + 2 lines)"}),e.jsx(N,{id:"edit-quantity",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:r.quantity,onChange:l=>x("quantity",l.target.value),required:!0}),a.quantity&&e.jsx(C,{message:a.quantity,className:"mt-1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(U,{id:"edit-notes",placeholder:"Reason for this stock adjustment",value:r.notes,onChange:l=>x("notes",l.target.value),rows:3}),a.notes&&e.jsx(C,{message:a.notes,className:"mt-1"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(b,{type:"button",variant:"outline",onClick:i,children:"Cancel"}),e.jsx(b,{onClick:_,disabled:c,children:c?"Updating...":"Update Adjustment"})]})]})]})})}function ue({products:d,onAddStock:i,onAdjustStock:t}){return e.jsxs(z,{children:[e.jsx(H,{children:e.jsx(M,{children:"Product Inventoryyyy"})}),e.jsx(Q,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left font-medium",children:"Product Name"}),e.jsx("th",{className:"p-2 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:d.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2 font-medium",children:s.name}),e.jsx("td",{className:"p-2 text-center",children:e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:()=>i(s),children:"Add Stock"}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>t(s),children:"Stock Adjustment"})]})})]},s.id))})]})})})]})}function xe({stock_activity_summary:d,start_date:i,end_date:t}){return e.jsxs("div",{className:"mb-8 rounded-lg bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx($,{className:"h-6 w-6 text-gray-500"}),e.jsxs("h2",{className:"text-2xl font-bold",children:["Product Stock Activity Summary"," ",i&&t?e.jsxs(e.Fragment,{children:["(",new Date(i).toLocaleDateString()," - ",new Date(t).toLocaleDateString(),")"]}):"(Today)"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(B,{children:[e.jsx(G,{children:e.jsxs(A,{children:[e.jsx(m,{children:"Product"}),e.jsx(m,{children:"Stock Received today"}),e.jsx(m,{children:"Available Stock"}),e.jsx(m,{className:"bg-blue-50",children:"Total available stock"}),e.jsx(m,{children:"Cash Sales"}),e.jsx(m,{children:"Credit Sales"}),e.jsx(m,{children:"Partial Sales"}),e.jsx(m,{className:"bg-green-50",children:"Total Sales"}),e.jsx(m,{className:"bg-yellow-50",children:"Remaining Stock"})]})}),e.jsx(J,{children:d.length?d.map((s,a)=>e.jsxs(A,{children:[e.jsx(o,{className:"font-medium",children:s.product}),e.jsx(o,{className:"text-center",children:s.stock_received_today}),e.jsx(o,{className:"text-center",children:s.previous_stock}),e.jsx(o,{className:"bg-blue-50 text-center font-semibold",children:s.total_available}),e.jsx(o,{className:"text-center",children:s.cash_sales}),e.jsx(o,{className:"text-center",children:s.credit_sales}),e.jsx(o,{className:"text-center",children:s.partial_sales}),e.jsx(o,{className:"bg-green-50 text-center font-semibold",children:s.total_sales}),e.jsx(o,{className:"bg-yellow-50 text-center font-semibold",children:s.remaining_stock})]},s.product+a)):e.jsx(A,{children:e.jsx(o,{colSpan:10,className:"text-muted-foreground py-4 text-center",children:"No data for today."})})})]})}),e.jsxs("div",{className:"text-muted-foreground mt-3 flex flex-col gap-1 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block h-4 w-4 rounded-sm border border-blue-100 bg-blue-50"}),e.jsx("span",{children:"Total available stock = Available stock + Stock received + Adjustments"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block h-4 w-4 rounded-sm border border-green-100 bg-green-50"}),e.jsx("span",{children:"Total Sales = Cash Sales + Credit Sales + Partial Sales"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block h-4 w-4 rounded-sm border border-yellow-100 bg-yellow-50"}),e.jsx("span",{children:"Remaining Stock = Total Available - Total Sales"})]})]})]})}function me({stock_movements:d,onDelete:i,onEdit:t}){return e.jsxs(z,{children:[e.jsx(H,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Stock Movements"]})}),e.jsx(Q,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(B,{children:[e.jsx(G,{children:e.jsxs(A,{children:[e.jsx(m,{children:"Product"}),e.jsx(m,{children:"Type"}),e.jsx(m,{children:"Quantity"}),e.jsx(m,{children:"Notes"}),e.jsx(m,{children:"Date"}),e.jsx(m,{children:"Actions"})]})}),e.jsx(J,{children:d.map(s=>{var a;return e.jsxs(A,{className:s.type.includes("adjustment")?"bg-yellow-50":"bg-green-50",children:[e.jsx(o,{className:"font-medium",children:(a=s.product)==null?void 0:a.name}),e.jsx(o,{children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${s.type==="received"?"bg-green-100 text-green-800":s.type==="adjustment_in"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:s.type==="received"?"Stock In":s.type==="adjustment_in"?"Adjustment In":"Adjustment Out"})}),e.jsx(o,{className:`font-medium ${s.type==="adjustment_out"?"text-yellow-600":"text-green-600"}`,children:s.quantity_display}),e.jsx(o,{children:s.notes}),e.jsx(o,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(o,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>t(s),children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>i(s.id),children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Delete"]})]})})]},s.id)})})]})})})]})}function we({stock_movements:d=[],products:i=[],stock_activity_summary:t=[],date:s}){const[a,r]=v.useState(!1),[x,g]=v.useState(!1),[c,j]=v.useState(!1),[_,n]=v.useState(!1),[l,S]=v.useState(null),[f,p]=v.useState(null),{data:y,setData:k,post:K,processing:P,errors:I,reset:V}=q({product_id:"",quantity:"",notes:"",date:new Date().toISOString().split("T")[0]}),[w,W]=v.useState(""),X=[{title:"Stock Control",href:"/stock-control"}];function Y(h){S(h),k({product_id:h.id,quantity:"",notes:"",date:w||new Date().toISOString().split("T")[0]}),r(!0)}function Z(h){S(h),g(!0)}function ee(h){h.preventDefault(),K(route("stock-control.store"),{onSuccess:()=>{V(),r(!1),S(null)},preserveScroll:!0,preserveState:!0,only:["products","stock_movements","stock_activity_summary","errors","flash"]})}function te(h){confirm("Are you sure you want to delete this stock movement?")&&E.delete(route("stock-control.destroy",h),{preserveScroll:!0,preserveState:!0,only:["stock_movements","products","stock_activity_summary","flash"]})}function se(h){p(h),h.type==="received"?(j(!0),n(!1)):["adjustment_in","adjustment_out"].includes(h.type)&&(n(!0),j(!1))}const ae=h=>{const O=h.target.value;W(O),O&&E.get(route("stock-control.index"),{date:O},{preserveState:!0,replace:!0})};return e.jsx(le,{breadcrumbs:X,children:e.jsxs("div",{className:"min-h-screen space-y-6 bg-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"As of date"}),e.jsx(N,{type:"date",value:w,onChange:ae,className:"w-auto"})]}),e.jsx(xe,{stock_activity_summary:t,start_date:w,end_date:w}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Inventory Management"})}),e.jsx(ue,{products:i,onAddStock:Y,onAdjustStock:Z}),e.jsx(re,{isOpen:a,onClose:()=>r(!1),selectedProduct:l,data:y,setData:k,errors:I,processing:P,onSubmit:ee}),e.jsx(de,{isOpen:x,onClose:()=>g(!1),selectedProduct:l}),e.jsx(ce,{isOpen:c,onClose:()=>{j(!1),p(null)},stockMovement:f,products:i,errors:I}),e.jsx(oe,{isOpen:_,onClose:()=>{n(!1),p(null)},stockMovement:f,products:i,errors:I}),e.jsx(me,{stock_movements:d,onDelete:te,onEdit:se})]})})}export{we as default};
