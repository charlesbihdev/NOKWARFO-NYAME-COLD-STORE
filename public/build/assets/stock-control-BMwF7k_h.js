import{j as e,u as E,r as N,a as D}from"./app-Bicvdzaq.js";import{b as L,A as ee}from"./app-layout-ClZ5XtJB.js";import{D as se}from"./DateRangePicker-Bkj6yHNp.js";import{F as b}from"./createLucideIcon-CjhkbSKr.js";import{D as I,b as O,c as H,d as R,e as te}from"./dialog-kOxqKTVd.js";import{I as S}from"./index-DuMDjP7Y.js";import{L as p}from"./label-D4Pr0DB7.js";import{I as v}from"./InputError-u4fE3LEH.js";import{T as ae}from"./textarea-Cqe5dgg6.js";import{C as P,a as U,b as G,c as M}from"./card-7QsND64p.js";import{T as $,a as z,b as C,c,d as Q,e as n}from"./table-CdVtybk0.js";import{S as le}from"./square-pen-umeStPrp.js";import{T as ie}from"./trash-2-i6uI8R_s.js";import"./index-dJniqGDa.js";import"./index-BZN2j33M.js";function re({isOpen:u,onClose:o,selectedProduct:t,data:s,setData:x,suppliers:l,errors:i,processing:h,onSubmit:f}){return e.jsx(I,{open:u,onOpenChange:o,children:e.jsxs(O,{className:"max-w-2xl",children:[e.jsx(H,{children:e.jsxs(R,{children:["Add Stock for ",t==null?void 0:t.name]})}),e.jsxs("form",{onSubmit:f,className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"type",className:"text-right",children:"Type *"}),e.jsxs("div",{className:"col-span-3",children:[e.jsxs("select",{id:"type",value:s.type,onChange:r=>x("type",r.target.value),required:!0,className:"w-full rounded border px-2 py-1",children:[e.jsx("option",{value:"received",children:"Stock In"}),e.jsx("option",{value:"sold",children:"Stock Out"})]}),i.type&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:i.type})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"quantity",className:"text-right",children:"Quantity *"}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(S,{id:"quantity",type:"text",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:s.quantity,onChange:r=>x("quantity",r.target.value),required:!0}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Format: 5C2L = 5 cartons + 2 lines, 10C = 10 cartons, 15L = 15 lines, or just a number"}),i.quantity&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:i.quantity})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"unit_cost",className:"text-right",children:"Unit Cost per Carton (GH₵) *"}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(S,{id:"unit_cost",type:"number",step:"0.01",placeholder:"0.00",value:s.unit_cost,onChange:r=>x("unit_cost",r.target.value),required:!0}),i.unit_cost&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:i.unit_cost})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"supplier_id",className:"text-right",children:"Supplier *"}),e.jsxs("div",{className:"col-span-3",children:[e.jsxs("select",{id:"supplier_id",value:s.supplier_id,onChange:r=>x("supplier_id",r.target.value),required:!0,className:"w-full rounded border px-2 py-1",children:[e.jsx("option",{value:"",children:"Select supplier"}),l.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),i.supplier_id&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:i.supplier_id})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"notes",className:"text-right",children:"Notes"}),e.jsx("div",{className:"col-span-3",children:e.jsx(S,{id:"notes",placeholder:"Optional notes",value:s.notes,onChange:r=>x("notes",r.target.value)})})]}),e.jsx(b,{type:"submit",disabled:h,children:"Add Stock"})]})]})})}function ne({isOpen:u,onClose:o,stockMovement:t,products:s,suppliers:x,errors:l={}}){const{data:i,setData:h,put:f,processing:r,reset:k}=E({product_id:"",supplier_id:"",type:"received",quantity:"",unit_cost:"",total_cost:"",notes:""});N.useEffect(()=>{var a,T;if(t){const q=(g,m)=>{if(m<=1)return g.toString();const y=Math.floor(g/m),j=g%m;return y>0&&j>0?`${y}C${j}L`:y>0?`${y}C`:j>0?`${j}L`:"0"},F=(g,m)=>m<=0?0:g*m;h({product_id:t.product_id||"",supplier_id:t.supplier_id?t.supplier_id.toString():"",type:t.type||"received",quantity:q(t.quantity,((a=t.product)==null?void 0:a.lines_per_carton)||1),unit_cost:F(t.unit_cost,((T=t.product)==null?void 0:T.lines_per_carton)||1),total_cost:t.total_cost||"",notes:t.notes||""})}},[t]);function A(){t&&f(route("stock-control.update",t.id),{onSuccess:()=>{k(),o()},preserveScroll:!0,preserveState:!0,only:["stock_movements","stock_activity_summary","errors","flash"]})}return t?e.jsx(I,{open:u,onOpenChange:o,children:e.jsxs(O,{className:"max-h-[90vh] max-w-2xl overflow-y-auto",children:[e.jsxs(H,{children:[e.jsx(R,{children:"Edit Stock Movement"}),e.jsx(te,{children:"Update the stock movement information. All fields marked with * are required."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit-product-id",children:"Product *"}),e.jsxs("select",{id:"edit-product-id",value:i.product_id,onChange:a=>h("product_id",a.target.value),required:!0,className:"w-full rounded border px-3 py-2",children:[e.jsx("option",{value:"",children:"Select product"}),s.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),l.product_id&&e.jsx(v,{message:l.product_id,className:"mt-1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit-supplier-id",children:"Supplier"}),e.jsxs("select",{id:"edit-supplier-id",value:i.supplier_id,onChange:a=>h("supplier_id",a.target.value),className:"w-full rounded border px-3 py-2",children:[e.jsx("option",{value:"",children:"Select supplier"}),x.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),l.supplier_id&&e.jsx(v,{message:l.supplier_id,className:"mt-1"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit-type",children:"Type *"}),e.jsxs("select",{id:"edit-type",value:i.type,onChange:a=>h("type",a.target.value),required:!0,className:"w-full rounded border px-3 py-2",children:[e.jsx("option",{value:"received",children:"Received"}),e.jsx("option",{value:"sold",children:"Sold"})]}),l.type&&e.jsx(v,{message:l.type,className:"mt-1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit-quantity",children:"Quantity * (Format: 5C2L for 5 cartons + 2 lines)"}),e.jsx(S,{id:"edit-quantity",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:i.quantity,onChange:a=>h("quantity",a.target.value),required:!0}),l.quantity&&e.jsx(v,{message:l.quantity,className:"mt-1"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit-unit-cost",children:"Unit Cost per Carton (GH₵)"}),e.jsx(S,{id:"edit-unit-cost",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:i.unit_cost,onChange:a=>h("unit_cost",a.target.value)}),l.unit_cost&&e.jsx(v,{message:l.unit_cost,className:"mt-1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit-total-cost",children:"Total Cost (GH₵)"}),e.jsx(S,{id:"edit-total-cost",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:i.total_cost,onChange:a=>h("total_cost",a.target.value)}),l.total_cost&&e.jsx(v,{message:l.total_cost,className:"mt-1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(ae,{id:"edit-notes",placeholder:"Additional notes about this stock movement",value:i.notes,onChange:a=>h("notes",a.target.value),rows:3}),l.notes&&e.jsx(v,{message:l.notes,className:"mt-1"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(b,{type:"button",variant:"outline",onClick:o,children:"Cancel"}),e.jsx(b,{onClick:A,disabled:r,children:r?"Updating...":"Update Stock Movement"})]})]})]})}):null}function ce({products:u,onAddStock:o}){return e.jsxs(P,{children:[e.jsx(U,{children:e.jsx(G,{children:"Product Inventory"})}),e.jsx(M,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left font-medium",children:"Product Name"}),e.jsx("th",{className:"p-2 text-center",children:"Current Stock"}),e.jsx("th",{className:"p-2 text-left",children:"Supplier"}),e.jsx("th",{className:"p-2 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:u.map(t=>{var s;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2 font-medium",children:t.name}),e.jsx("td",{className:"p-2 text-center",children:t.current_stock_display??"0"}),e.jsx("td",{className:"p-2",children:((s=t.supplier)==null?void 0:s.name)||"N/A"}),e.jsx("td",{className:"p-2 text-center",children:e.jsx(b,{variant:"outline",size:"sm",onClick:()=>o(t),children:"Add Stock"})})]},t.id)})})]})})})]})}function de({stock_activity_summary:u,start_date:o,end_date:t}){return e.jsxs("div",{className:"mb-8 rounded-lg bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(L,{className:"h-6 w-6 text-gray-500"}),e.jsxs("h2",{className:"text-2xl font-bold",children:["Product Stock Activity Summary"," ",o&&t?e.jsxs(e.Fragment,{children:["(",new Date(o).toLocaleDateString()," - ",new Date(t).toLocaleDateString(),")"]}):"(Today)"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($,{children:[e.jsx(z,{children:e.jsxs(C,{children:[e.jsx(c,{children:"Product"}),e.jsx(c,{children:"Stock Received today"}),e.jsx(c,{children:"Previous Stock"}),e.jsx(c,{className:"bg-blue-50",children:"Total Available"}),e.jsx(c,{children:"Cash Sales"}),e.jsx(c,{children:"Credit Sales"}),e.jsx(c,{children:"Partial Sales"}),e.jsx(c,{className:"bg-green-50",children:"Total Sales"}),e.jsx(c,{className:"bg-yellow-50",children:"Remaining Stock"})]})}),e.jsx(Q,{children:u.length?u.map((s,x)=>e.jsxs(C,{children:[e.jsx(n,{className:"font-medium",children:s.product}),e.jsx(n,{className:"text-center",children:s.stock_received_today}),e.jsx(n,{className:"text-center",children:s.previous_stock}),e.jsx(n,{className:"bg-blue-50 text-center font-semibold",children:s.total_available}),e.jsx(n,{className:"text-center",children:s.cash_sales}),e.jsx(n,{className:"text-center",children:s.credit_sales}),e.jsx(n,{className:"text-center",children:s.partial_sales}),e.jsx(n,{className:"bg-green-50 text-center font-semibold",children:s.total_sales}),e.jsx(n,{className:"bg-yellow-50 text-center font-semibold",children:s.remaining_stock})]},s.product+x)):e.jsx(C,{children:e.jsx(n,{colSpan:9,className:"text-muted-foreground py-4 text-center",children:"No data for today."})})})]})}),e.jsxs("div",{className:"text-muted-foreground mt-3 flex flex-col gap-1 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block h-4 w-4 rounded-sm border border-blue-100 bg-blue-50"}),e.jsx("span",{children:"Total Available = Stock Received + Previous Stock"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block h-4 w-4 rounded-sm border border-green-100 bg-green-50"}),e.jsx("span",{children:"Total Sales = Cash Sales + Credit Sales + Partial Sales"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block h-4 w-4 rounded-sm border border-yellow-100 bg-yellow-50"}),e.jsx("span",{children:"Remaining Stock = Total Available - Total Sales"})]})]})]})}function oe({stock_movements:u,onDelete:o,onEdit:t}){return e.jsxs(P,{children:[e.jsx(U,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"Stock Movements"]})}),e.jsx(M,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($,{children:[e.jsx(z,{children:e.jsxs(C,{children:[e.jsx(c,{children:"Product"}),e.jsx(c,{children:"Supplier"}),e.jsx(c,{children:"Type"}),e.jsx(c,{children:"Quantity"}),e.jsx(c,{children:"Unit Cost"}),e.jsx(c,{children:"Total Cost"}),e.jsx(c,{children:"Notes"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(Q,{children:u.map(s=>{var x,l;return e.jsxs(C,{children:[e.jsx(n,{children:(x=s.product)==null?void 0:x.name}),e.jsx(n,{children:(l=s.supplier)==null?void 0:l.name}),e.jsx(n,{children:s.type}),e.jsx(n,{children:s.quantity_display}),e.jsxs(n,{children:["GH₵",parseFloat(s.price_per_carton).toFixed(2)]}),e.jsxs(n,{children:["GH₵",parseFloat(s.total_cost).toFixed(2)]}),e.jsx(n,{children:s.notes}),e.jsx(n,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>t(s),children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>o(s.id),children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"Delete"]})]})})]},s.id)})})]})})})]})}function ke({stock_movements:u=[],products:o=[],suppliers:t=[],stock_activity_summary:s=[],date:x}){const[l,i]=N.useState(!1),[h,f]=N.useState(!1),[r,k]=N.useState(null),[A,a]=N.useState(null),{data:T,setData:q,post:F,processing:g,errors:m,reset:y}=E({product_id:"",supplier_id:"",type:"received",quantity:"",unit_cost:"",total_cost:"",notes:""}),[j,B]=N.useState(""),[w,J]=N.useState(""),K=[{title:"Stock Control",href:"/stock-control"}];function V(d){k(d),q({product_id:d.id,supplier_id:d.supplier_id?d.supplier_id.toString():"",type:"received",quantity:"",unit_cost:d.cost_price||"",total_cost:"",notes:""}),i(!0)}function W(d){d.preventDefault(),F(route("stock-control.store"),{onSuccess:()=>{y(),i(!1),k(null)},preserveScroll:!0,preserveState:!0,only:["products","stock_movements","stock_activity_summary","errors","flash"]})}function X(d){confirm("Are you sure you want to delete this stock movement?")&&D.delete(route("stock-control.destroy",d),{preserveScroll:!0,preserveState:!1})}function Y(d){a(d),f(!0)}const Z=(d,_)=>{_==="start"?B(d):_==="end"&&J(d),(_==="start"&&w||_==="end"&&j)&&D.get(route("stock-control.index"),{start_date:_==="start"?d:j,end_date:_==="end"?d:w},{preserveState:!0,replace:!0})};return e.jsx(ee,{breadcrumbs:K,children:e.jsxs("div",{className:"min-h-screen space-y-6 bg-gray-100 p-6",children:[e.jsx(se,{startDate:j,endDate:w,onChange:Z}),e.jsx(de,{stock_activity_summary:s,start_date:j,end_date:w}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Inventory Management"})}),e.jsx(ce,{products:o,onAddStock:V}),e.jsx(re,{isOpen:l,onClose:()=>i(!1),selectedProduct:r,data:T,setData:q,suppliers:t,errors:m,processing:g,onSubmit:W}),e.jsx(ne,{isOpen:h,onClose:()=>{f(!1),a(null)},stockMovement:A,products:o,suppliers:t,errors:m}),e.jsx(oe,{stock_movements:u,onDelete:X,onEdit:Y})]})})}export{ke as default};
