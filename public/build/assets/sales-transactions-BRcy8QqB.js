import{r as o,j as e,u as ie,a as se,L as ae}from"./app-IpDexUkN.js";import{c as Ne,F as C}from"./createLucideIcon-JR7TBAdw.js";import{C as $,a as Q,b as K,c as W}from"./card-Datb66K2.js";import{f as ye,A as ve}from"./app-layout-BFhBj9u0.js";import{I as de}from"./InputError-DFSKryDc.js";import{D as ce,b as oe,c as me,d as xe,X as ee,f as pe}from"./dialog-DX-NdddR.js";import{I as k}from"./input-Dwv0R-j5.js";import{C as _e,S as z,a as V,b as B,c as U,d as O}from"./select-rfp_LvRV.js";import{S as ue,l as Ce}from"./lodash-BzbrT40b.js";import{P as he}from"./pencil-Cp0ie2gH.js";import{P as we}from"./plus-BoFh4Jbm.js";import{T as Se}from"./trash-2-5JMONNu1.js";import{B as re}from"./badge-CmzsWlgc.js";import{T as ke,a as Fe,b as ne,c as T,d as De,e as A}from"./table-BAEXV-Dd.js";import{D as Pe}from"./DateRangePicker-rLLysP0R.js";import{P as je}from"./printer-_-e5YrQd.js";import"./index-Cdu7Mxog.js";import"./index-CgFigxQE.js";import"./index-DN91QoUF.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],le=Ne("User",Ee);function Ie({open:d,onClose:N,products:p,customers:y,form:r,items:h,setItems:v,amountPaid:t,setAmountPaid:j,dueDate:F,setDueDate:w,paymentType:u,setPaymentType:P,runningTotal:S,onSaleSuccess:R}){const[_,n]=o.useState(""),[m,x]=o.useState(!1),b=o.useRef(null),s=o.useMemo(()=>{if(!_.trim())return y.slice(0,10);const a=_.toLowerCase();return y.filter(g=>g.name.toLowerCase().includes(a)||g.phone&&g.phone.includes(_)).slice(0,10)},[_,y]),c=o.useMemo(()=>r.data.customer_id?y.find(a=>String(a.id)===String(r.data.customer_id)):null,[r.data.customer_id,y]);o.useEffect(()=>{const a=g=>{b.current&&!b.current.contains(g.target)&&x(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),o.useEffect(()=>{d||(n(""),x(!1))},[d]),o.useEffect(()=>{r.setData("items",h)},[h]),o.useEffect(()=>{r.setData("amount_paid",t)},[t]),o.useEffect(()=>{r.setData("due_date",F)},[F]),o.useEffect(()=>{r.setData("payment_type",u)},[u]);const l=a=>p.find(g=>String(g.id)===String(a))||null,f=(a,g,E)=>{const G=h.map((i,M)=>{if(M!==a)return i;let D={...i,[g]:E};const te=l(D.product_id);if(!te)return D;const X=te.lines_per_carton||1;let J=0;if(X>1){const Y=parseInt(D.cartons)||0,Z=parseInt(D.lines)||0;J=Y*X+Z;const fe=(parseFloat(D.unit_selling_price)||0)/X;D.qty=J,D.total=(fe*J).toFixed(2)}else{const Y=parseInt(D.qty)||0,Z=parseFloat(D.unit_selling_price)||0;D.qty=Y,D.total=(Z*Y).toFixed(2),D.cartons=void 0,D.lines=void 0}return D});v(G)},I=()=>{v([...h,{product_id:"",qty:"",unit_selling_price:"",total:"",cartons:0,lines:0}])},q=a=>{h.length!==1&&v(h.filter((g,E)=>E!==a))},L=a=>{j(a),u==="partial"&&(parseFloat(a)<=0||parseFloat(a)>=S?r.setError("amount_paid","For partial payments, the amount paid must be greater than 0 and less than the total."):r.setError("amount_paid",void 0))},H=a=>{P(a),a==="credit"?(j("0"),r.setError("amount_paid",void 0),r.data.customer_id||r.setData("customer_name","")):a==="cash"?(j(S.toString()),r.setError("amount_paid",void 0)):a==="partial"&&(j(""),r.setError("amount_paid",void 0),r.data.customer_id||r.setData("customer_name",""))};return e.jsx(ce,{open:d,onOpenChange:N,children:e.jsxs(oe,{children:[e.jsx(me,{children:e.jsx(xe,{children:"Add Sales Transaction"})}),e.jsxs("form",{onSubmit:a=>{if(a.preventDefault(),u==="cash"&&parseFloat(t)!==S){r.setError("amount_paid","For cash payments, the amount paid must equal the total.");return}if(u==="credit"&&parseFloat(t)!==0){r.setError("amount_paid","For credit sales, the amount paid must be 0.");return}if(u==="partial"&&(parseFloat(t)<=0||parseFloat(t)>=S)){r.setError("amount_paid","For partial payments, the amount paid must be greater than 0 and less than the total.");return}r.post("/sales-transactions",{onSuccess:g=>{var E;if((E=g.props.sales_transactions)!=null&&E.data&&R){const G=g.props.sales_transactions.data[0];G&&R(G)}N()}})},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block font-medium",children:["Transaction Date",e.jsx(k,{type:"date",value:r.data.transaction_date,onChange:a=>r.setData("transaction_date",a.target.value),required:!0})]}),r.errors.transaction_date&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:r.errors.transaction_date})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block font-medium",children:["Customer ",(u==="credit"||u==="partial")&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",ref:b,children:[e.jsxs("div",{className:`flex items-center gap-2 w-full border rounded-md px-3 py-2 cursor-pointer bg-background ${(u==="credit"||u==="partial")&&!r.data.customer_id?"border-orange-500":"border-input"}`,onClick:()=>x(!m),children:[e.jsx(le,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsx("span",{className:`flex-1 truncate ${c?"":"text-muted-foreground"}`,children:c?c.name:"Search customers..."}),c?e.jsx(ee,{className:"h-4 w-4 text-muted-foreground hover:text-foreground cursor-pointer",onClick:a=>{a.stopPropagation(),r.setData("customer_id",null),n("")}}):e.jsx(_e,{className:"h-4 w-4 text-muted-foreground shrink-0"})]}),m&&e.jsxs("div",{className:"absolute z-50 mt-1 w-full rounded-md border bg-popover shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 border-b",children:[e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Type to search...",value:_,onChange:a=>n(a.target.value),className:"flex-1 bg-transparent border-0 outline-none text-sm",autoFocus:!0,onClick:a=>a.stopPropagation()})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto p-1",children:s.length===0?e.jsx("div",{className:"p-3 text-center text-sm text-muted-foreground",children:"No customers found"}):s.map(a=>e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-md cursor-pointer hover:bg-accent ${String(r.data.customer_id)===String(a.id)?"bg-accent":""}`,onClick:()=>{r.setData("customer_id",String(a.id)),r.setData("customer_name",""),x(!1),n("")},children:[e.jsx(le,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"flex-1 truncate",children:a.name})]},a.id))})]})]}),!r.data.customer_id&&u==="cash"&&e.jsx(k,{type:"text",placeholder:"Or enter customer name",value:r.data.customer_name,onChange:a=>r.setData("customer_name",a.target.value),className:"flex-1"})]}),(u==="credit"||u==="partial")&&!r.data.customer_id&&e.jsx("div",{className:"mt-2 rounded-md bg-orange-50 p-3 border border-orange-200",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-orange-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-orange-800",children:"Registered Customer Required"}),e.jsx("div",{className:"mt-1 text-xs text-orange-700",children:"Credit and partial sales require selecting a registered customer to track who owes money."})]})]})}),r.errors.customer_id&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:r.errors.customer_id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block font-medium",children:"Items"}),e.jsxs("div",{className:"max-h-64 space-y-2 overflow-y-auto",children:[h.map((a,g)=>{const E=l(a.product_id),G=(E==null?void 0:E.lines_per_carton)||1;return e.jsxs("div",{className:"grid w-full grid-cols-4 items-end gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsxs(z,{value:a.product_id,onValueChange:i=>f(g,"product_id",i),children:[e.jsx(V,{children:e.jsx(B,{placeholder:"Product"})}),e.jsx(U,{children:p.map(i=>e.jsx(O,{value:String(i.id),children:i.name},i.id))})]})}),G>1?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"",children:e.jsx(k,{type:"number",min:"0",placeholder:"Cartons",value:a.cartons||"",onChange:i=>f(g,"cartons",i.target.value)})}),e.jsx("div",{className:"",children:e.jsxs(z,{value:a.lines!==void 0?String(a.lines):"",onValueChange:i=>f(g,"lines",i),children:[e.jsx(V,{children:e.jsx(B,{placeholder:"Lines"})}),e.jsx(U,{children:[...Array(G).keys()].map(i=>e.jsx(O,{value:String(i+1),children:i+1},i+1))})]})})]}):e.jsx("div",{className:"",children:e.jsx(k,{type:"number",min:"1",placeholder:"Qty",value:a.qty||"",onChange:i=>f(g,"qty",i.target.value)})}),e.jsx("div",{className:"",children:e.jsx(k,{type:"number",min:"0",step:"0.01",placeholder:"Unit Price",value:a.unit_selling_price||"",onChange:i=>f(g,"unit_selling_price",i.target.value)})}),e.jsx("div",{className:"",children:e.jsx(k,{type:"number",min:"0",step:"0.01",placeholder:"Total",value:a.total||"",readOnly:!0})}),e.jsx(C,{type:"button",variant:"destructive",size:"sm",className:"text-white",onClick:()=>q(g),disabled:h.length===1,children:"Remove"})]},g)}),e.jsx(C,{type:"button",variant:"outline",size:"sm",onClick:I,children:"Add Item"})]}),r.errors.items&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:r.errors.items})]}),e.jsxs("div",{className:"text-lg font-bold",children:["Total: GH₵",S.toFixed(2)]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"mb-1 block font-medium",children:"Payment Type"}),e.jsxs(z,{value:u,onValueChange:H,children:[e.jsx(V,{children:e.jsx(B,{placeholder:"Select payment type"})}),e.jsxs(U,{children:[e.jsx(O,{value:"cash",children:"Cash"}),e.jsx(O,{value:"credit",children:"Credit"}),e.jsx(O,{value:"partial",children:"Partial"})]})]}),r.errors.payment_type&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:r.errors.payment_type})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"mb-1 block font-medium",children:"Amount Paid"}),e.jsx(k,{type:"number",min:u==="partial"?1:0,max:u==="partial"?S-1:S,step:"0.01",value:t,onChange:a=>L(a.target.value),disabled:u==="credit"||u==="cash"}),r.errors.amount_paid&&e.jsx(de,{message:r.errors.amount_paid,className:"mt-2"})]}),u!=="cash"&&e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"mb-1 block font-medium",children:"Due Date"}),e.jsx(k,{type:"date",value:F,onChange:a=>w(a.target.value)}),r.errors.due_date&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:r.errors.due_date})]})]}),e.jsxs(pe,{children:[e.jsx(C,{type:"button",variant:"secondary",onClick:N,children:"Cancel"}),e.jsx(C,{type:"submit",children:r.processing?"Saving..":"Save"})]})]})]})})}function Te({open:d,onClose:N,transaction:p,products:y,customers:r}){const[h,v]=o.useState([]),t=ie({customer_id:"",customer_name:"",payment_type:"cash",amount_paid:"",items:[]});o.useEffect(()=>{if(d&&p){const n=p.sale_items.map(x=>{const b=y.find(a=>a.name===x.product),s=(b==null?void 0:b.lines_per_carton)||1;let c=0,l=0,f=0;const I=String(x.quantity),q=I.match(/(\d+)C(\d+)L/),L=I.match(/(\d+)C$/),H=I.match(/^(\d+)L$/);return q?(c=parseInt(q[1])||0,l=parseInt(q[2])||0,f=c*s+l):L?(c=parseInt(L[1])||0,f=c*s):H?(l=parseInt(H[1])||0,f=l):(f=parseInt(I)||0,s>1&&(c=Math.floor(f/s),l=f%s)),{product_id:b?String(b.id):"",product_name:x.product,cartons:c,lines:l,qty:f,unit_selling_price:parseFloat(x.unit_selling_price)||0,total:parseFloat(x.total)||0}});v(n.length>0?n:[{product_id:"",qty:"",unit_selling_price:"",total:"",cartons:0,lines:0}]);const m=r.find(x=>x.name===p.customer);t.setData({customer_id:m?String(m.id):"",customer_name:m?"":p.customer||"",payment_type:p.payment_type.toLowerCase(),amount_paid:String(p.amount_paid),items:n})}},[d,p]),o.useEffect(()=>{t.setData("items",h)},[h]);const j=h.reduce((n,m)=>n+(parseFloat(m.total)||0),0);o.useEffect(()=>{t.data.payment_type==="cash"?t.setData("amount_paid",j.toString()):t.data.payment_type==="credit"&&t.setData("amount_paid","0")},[t.data.payment_type,j]);const F=n=>y.find(m=>String(m.id)===String(n))||null,w=(n,m,x)=>{const b=h.map((s,c)=>{if(c!==n)return s;let l={...s,[m]:x};const f=F(l.product_id);if(!f)return l;const I=f.lines_per_carton||1;let q=0;if(I>1){const L=parseInt(l.cartons)||0,H=parseInt(l.lines)||0;q=L*I+H;const g=(parseFloat(l.unit_selling_price)||0)/I;l.qty=q,l.total=(g*q).toFixed(2)}else{const L=parseInt(l.qty)||0,H=parseFloat(l.unit_selling_price)||0;l.qty=L,l.total=(H*L).toFixed(2),l.cartons=void 0,l.lines=void 0}return l});v(b)},u=()=>{v([...h,{product_id:"",qty:"",unit_selling_price:"",total:"",cartons:0,lines:0}])},P=n=>{h.length!==1&&v(h.filter((m,x)=>x!==n))},S=n=>{t.setData("payment_type",n),t.clearErrors("amount_paid"),(n==="credit"||n==="partial")&&!t.data.customer_id&&t.setData("customer_name","")},R=n=>{t.setData("amount_paid",n),t.clearErrors("amount_paid")},_=n=>{n.preventDefault();const m=parseFloat(t.data.amount_paid),x=t.data.payment_type;if(x==="cash"&&m!==j){t.setError("amount_paid","For cash payments, the amount paid must equal the total.");return}if(x==="credit"&&m!==0){t.setError("amount_paid","For credit sales, the amount paid must be 0.");return}if(x==="partial"&&(m<=0||m>=j)){t.setError("amount_paid","For partial payments, amount must be greater than 0 and less than total.");return}t.put(route("sales-transactions.update",p.id),{onSuccess:()=>{N()}})};return p?e.jsx(ce,{open:d,onOpenChange:N,children:e.jsxs(oe,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(me,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5"}),"Edit Sale: ",p.id]})}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date:"}),e.jsx("span",{className:"font-medium",children:p.date})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Original Total:"}),e.jsxs("span",{className:"font-medium",children:["GH₵",parseFloat(p.total).toFixed(2)]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block font-medium",children:["Customer ",(t.data.payment_type==="credit"||t.data.payment_type==="partial")&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{value:t.data.customer_id?String(t.data.customer_id):"none",onValueChange:n=>{n==="none"?t.setData("customer_id",""):(t.setData("customer_id",n),t.setData("customer_name",""))},children:[e.jsx(V,{className:(t.data.payment_type==="credit"||t.data.payment_type==="partial")&&!t.data.customer_id?"border-orange-500":"",children:e.jsx(B,{placeholder:"Select customer"})}),e.jsxs(U,{children:[t.data.payment_type==="cash"&&e.jsx(O,{value:"none",children:"-- No customer selected --"}),r.map(n=>e.jsx(O,{value:String(n.id),children:n.name},n.id))]})]}),!t.data.customer_id&&t.data.payment_type==="cash"&&e.jsx(k,{type:"text",placeholder:"Or enter customer name",value:t.data.customer_name,onChange:n=>t.setData("customer_name",n.target.value)})]}),(t.data.payment_type==="credit"||t.data.payment_type==="partial")&&!t.data.customer_id&&e.jsx("div",{className:"mt-2 rounded-md bg-orange-50 p-3 border border-orange-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 text-orange-400 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-sm text-orange-800",children:"Credit/partial sales require a registered customer."})]})}),t.errors.customer_id&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:t.errors.customer_id})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"font-medium",children:"Items"}),e.jsxs(C,{type:"button",variant:"outline",size:"sm",onClick:u,children:[e.jsx(we,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:h.map((n,m)=>{const x=F(n.product_id),b=(x==null?void 0:x.lines_per_carton)||1;return e.jsxs("div",{className:"p-3 border rounded-lg bg-gray-50 space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-end",children:[e.jsxs("div",{className:"col-span-5",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Product"}),e.jsxs(z,{value:n.product_id,onValueChange:s=>w(m,"product_id",s),children:[e.jsx(V,{children:e.jsx(B,{placeholder:"Select product"})}),e.jsx(U,{children:y.map(s=>e.jsx(O,{value:String(s.id),children:s.name},s.id))})]})]}),b>1?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Cartons"}),e.jsx(k,{type:"number",min:"0",value:n.cartons||"",onChange:s=>w(m,"cartons",s.target.value)})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Lines"}),e.jsxs(z,{value:n.lines!==void 0?String(n.lines):"",onValueChange:s=>w(m,"lines",s),children:[e.jsx(V,{children:e.jsx(B,{placeholder:"Lines"})}),e.jsx(U,{children:[...Array(b).keys()].map(s=>e.jsx(O,{value:String(s),children:s},s))})]})]})]}):e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Quantity"}),e.jsx(k,{type:"number",min:"1",value:n.qty||"",onChange:s=>w(m,"qty",s.target.value)})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Unit Price"}),e.jsx(k,{type:"number",min:"0",step:"0.01",value:n.unit_selling_price||"",onChange:s=>w(m,"unit_selling_price",s.target.value)})]}),e.jsx("br",{}),e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"text-xs text-gray-600 mb-1 block",children:"Total"}),e.jsx(k,{type:"text",value:`GH₵${parseFloat(n.total||0).toFixed(2)}`,readOnly:!0,className:"bg-gray-100"})]}),e.jsx("div",{className:"col-span-1 flex items-end",children:e.jsx(C,{type:"button",variant:"ghost",size:"sm",onClick:()=>P(m),disabled:h.length===1,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(Se,{className:"h-4 w-4"})})})]}),x&&b>1&&e.jsxs("div",{className:"text-xs text-gray-500",children:[n.cartons||0," cartons + ",n.lines||0," lines = ",n.qty||0," total lines (",b," lines/carton)"]})]},m)})}),t.errors.items&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:t.errors.items})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold text-blue-800",children:"New Total:"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-900",children:["GH₵",j.toFixed(2)]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block font-medium",children:"Payment Type"}),e.jsxs(z,{value:t.data.payment_type,onValueChange:S,children:[e.jsx(V,{children:e.jsx(B,{placeholder:"Select payment type"})}),e.jsxs(U,{children:[e.jsx(O,{value:"cash",children:"Cash"}),e.jsx(O,{value:"credit",children:"Credit"}),e.jsx(O,{value:"partial",children:"Partial"})]})]}),t.errors.payment_type&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:t.errors.payment_type})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block font-medium",children:"Amount Paid"}),e.jsx(k,{type:"number",min:"0",max:j,step:"0.01",value:t.data.amount_paid,onChange:n=>R(n.target.value)}),t.errors.amount_paid&&e.jsx(de,{message:t.errors.amount_paid,className:"mt-2"})]})]}),t.data.payment_type!=="cash"&&e.jsx("div",{className:"bg-orange-50 p-3 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-orange-800",children:"Amount Owed:"}),e.jsxs("span",{className:"font-bold text-orange-900",children:["GH₵",Math.max(0,j-parseFloat(t.data.amount_paid||0)).toFixed(2)]})]})}),e.jsxs(pe,{className:"gap-2",children:[e.jsx(C,{type:"button",variant:"outline",onClick:N,children:"Cancel"}),e.jsx(C,{type:"submit",disabled:t.processing,children:t.processing?"Saving...":"Save Changes"})]})]})]})}):null}const be=({transaction:d,onClose:N})=>{const p=()=>{window.print()},y=d.sale_items.reduce((t,j)=>t+parseFloat(j.total),0);return e.jsx("div",{className:"receipt-print-wrapper fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 print:static print:block print:bg-transparent print:p-0",children:e.jsxs("div",{className:"receipt-container max-h-[90vh] w-full max-w-md overflow-y-auto rounded-lg bg-white p-6 shadow-xl print:max-h-none print:overflow-visible print:rounded-none print:shadow-none",children:[e.jsxs("div",{className:"mb-4 text-center print:mb-2",children:[e.jsx("div",{className:"mx-auto mb-2 w-full border-b-2 border-dashed border-black print:mb-1 print:border-b"}),e.jsx("h1",{className:"text-xl font-bold tracking-wide uppercase print:text-base",children:"NOKWARFO NYAME COLD STORE"}),e.jsx("p",{className:"text-sm text-gray-600 print:text-xs print:text-black",children:"Kasoa"}),e.jsxs("p",{className:"text-sm text-gray-600 print:text-xs print:text-black",children:["Tel: ","024 375 6588 / 024 693 7080 / 055 515 1777"]}),e.jsx("div",{className:"mx-auto mt-2 w-full border-b-2 border-dashed border-black print:mt-1 print:border-b"})]}),e.jsx("div",{className:"mb-4 text-center print:mb-2",children:e.jsx("span",{className:"inline-block rounded bg-red-100 px-4 py-1 text-lg font-bold text-red-700 print:border print:border-black print:bg-transparent print:px-0 print:py-0 print:text-sm print:text-black",children:"CREDIT SALE"})}),e.jsxs("div",{className:"mb-4 space-y-2 text-sm print:mb-2 print:space-y-1 print:text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Receipt #:"}),e.jsx("span",{className:"font-mono",children:d.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Date:"}),e.jsx("span",{children:d.date})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Creditor:"}),e.jsx("span",{className:"max-w-[60%] truncate text-right",children:d.customer||"Walk-in Customer"})]})]}),e.jsx("div",{className:"my-3 border-t border-dashed border-gray-400 print:my-1 print:border-black"}),e.jsxs("table",{className:"mb-4 w-full text-sm print:mb-2 print:text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-black",children:[e.jsx("th",{className:"pb-2 text-left font-bold print:pb-1",children:"Item"}),e.jsx("th",{className:"pb-2 text-center font-bold print:pb-1",children:"Qty"}),e.jsx("th",{className:"pb-2 text-right font-bold print:pb-1",children:"Price"}),e.jsx("th",{className:"pb-2 text-right font-bold print:pb-1",children:"Total"})]})}),e.jsx("tbody",{children:d.sale_items.map((t,j)=>e.jsxs("tr",{className:"border-b border-gray-200 print:border-gray-400",children:[e.jsx("td",{className:"py-2 pr-1 print:max-w-[80px] print:truncate print:py-1",children:t.product}),e.jsx("td",{className:"py-2 text-center print:py-1",children:t.quantity}),e.jsx("td",{className:"py-2 text-right print:py-1",children:parseFloat(t.unit_selling_price).toFixed(2)}),e.jsx("td",{className:"py-2 text-right font-medium print:py-1",children:parseFloat(t.total).toFixed(2)})]},j))})]}),e.jsxs("div",{className:"space-y-2 border-t-2 border-black pt-3 print:space-y-1 print:pt-2",children:[e.jsxs("div",{className:"flex justify-between text-base print:text-xs",children:[e.jsx("span",{className:"font-semibold",children:"Subtotal:"}),e.jsxs("span",{children:["GH₵ ",y.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-base print:text-xs",children:[e.jsx("span",{className:"font-semibold",children:"Amount Paid:"}),e.jsxs("span",{children:["GH₵ ",parseFloat(d.amount_paid).toFixed(2)]})]}),e.jsx("div",{className:"my-2 border-t border-dashed border-gray-400 print:my-1 print:border-black"}),e.jsxs("div",{className:"flex justify-between text-lg font-bold print:text-sm",children:[e.jsx("span",{className:"text-red-600 print:text-black",children:"BALANCE DUE:"}),e.jsxs("span",{className:"text-red-600 print:text-black",children:["GH₵ ",parseFloat(d.amount_owed).toFixed(2)]})]})]}),e.jsxs("div",{className:"mt-6 border-t-2 border-dashed border-black pt-4 text-center print:mt-3 print:pt-2",children:[e.jsx("p",{className:"text-sm text-gray-500 print:text-[10px] print:text-black",children:"Goods sold are NOT returnable."}),e.jsx("p",{className:"mt-2 text-sm font-semibold print:mt-1 print:text-xs",children:"Thank You For Your Patronage!"}),e.jsx("div",{className:"mt-3 text-[10px] text-gray-400 print:mt-2 print:text-[10px] print:text-black",children:"*** CREDIT TRANSACTION ***"})]}),e.jsxs("div",{className:"mt-6 flex gap-3 print:hidden",children:[e.jsxs(C,{onClick:p,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Print Receipt"]}),e.jsxs(C,{onClick:N,variant:"outline",className:"flex-1",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Close"]})]})]})})},ge=({transaction:d,onClose:N})=>{const p=()=>{window.print()},y=d.sale_items.reduce((t,j)=>t+parseFloat(j.total),0);return e.jsx("div",{className:"receipt-print-wrapper fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 print:static print:block print:bg-transparent print:p-0",children:e.jsxs("div",{className:"receipt-container max-h-[90vh] w-full max-w-md overflow-y-auto rounded-lg bg-white p-6 shadow-xl print:max-h-none print:overflow-visible print:rounded-none print:shadow-none",children:[e.jsxs("div",{className:"mb-4 text-center print:mb-2",children:[e.jsx("div",{className:"mx-auto mb-2 w-full border-b-2 border-dashed border-black print:mb-1 print:border-b"}),e.jsx("h1",{className:"text-xl font-bold tracking-wide uppercase print:text-base",children:"NOKWARFO NYAME COLD STORE"}),e.jsx("p",{className:"text-sm text-gray-600 print:text-xs print:text-black",children:"Kasoa"}),e.jsxs("p",{className:"text-sm text-gray-600 print:text-xs print:text-black",children:["Tel: ","024 375 6588 / 024 693 7080 / 055 515 1777"]}),e.jsx("div",{className:"mx-auto mt-2 w-full border-b-2 border-dashed border-black print:mt-1 print:border-b"})]}),e.jsx("div",{className:"mb-4 text-center print:mb-2",children:e.jsx("span",{className:"inline-block rounded bg-green-100 px-4 py-1 text-lg font-bold text-green-700 print:border print:border-black print:bg-transparent print:px-0 print:py-0 print:text-sm print:text-black",children:"CASH SALE"})}),e.jsxs("div",{className:"mb-4 space-y-2 text-sm print:mb-2 print:space-y-1 print:text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Receipt #:"}),e.jsx("span",{className:"font-mono",children:d.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Date:"}),e.jsx("span",{children:d.date})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Customer:"}),e.jsx("span",{className:"max-w-[60%] truncate text-right",children:d.customer||"Walk-in Customer"})]})]}),e.jsx("div",{className:"my-3 border-t border-dashed border-gray-400 print:my-1 print:border-black"}),e.jsxs("table",{className:"mb-4 w-full text-sm print:mb-2 print:text-[11px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-black",children:[e.jsx("th",{className:"pb-2 text-left font-bold print:pb-1",children:"Item"}),e.jsx("th",{className:"pb-2 text-center font-bold print:pb-1",children:"Qty"}),e.jsx("th",{className:"pb-2 text-right font-bold print:pb-1",children:"Price"}),e.jsx("th",{className:"pb-2 text-right font-bold print:pb-1",children:"Total"})]})}),e.jsx("tbody",{children:d.sale_items.map((t,j)=>e.jsxs("tr",{className:"border-b border-gray-200 print:border-gray-400",children:[e.jsx("td",{className:"py-2 pr-1 print:max-w-[80px] print:truncate print:py-1",children:t.product}),e.jsx("td",{className:"py-2 text-center print:py-1",children:t.quantity}),e.jsx("td",{className:"py-2 text-right print:py-1",children:parseFloat(t.unit_selling_price).toFixed(2)}),e.jsx("td",{className:"py-2 text-right font-medium print:py-1",children:parseFloat(t.total).toFixed(2)})]},j))})]}),e.jsxs("div",{className:"space-y-2 border-t-2 border-black pt-3 print:space-y-1 print:pt-2",children:[e.jsxs("div",{className:"flex justify-between text-lg font-bold print:text-sm",children:[e.jsx("span",{children:"TOTAL:"}),e.jsxs("span",{children:["GH₵ ",y.toFixed(2)]})]}),e.jsx("div",{className:"my-2 border-t border-dashed border-gray-400 print:my-1 print:border-black"}),e.jsxs("div",{className:"flex justify-between text-base text-green-600 print:text-xs print:text-black",children:[e.jsx("span",{className:"font-semibold",children:"PAID IN FULL"}),e.jsx("span",{children:"✓"})]})]}),e.jsxs("div",{className:"mt-6 border-t-2 border-dashed border-black pt-4 text-center print:mt-3 print:pt-2",children:[e.jsx("p",{className:"text-sm text-gray-500 print:text-[10px] print:text-black",children:"Goods sold are NOT returnable."}),e.jsx("p",{className:"mt-2 text-sm font-semibold print:mt-1 print:text-xs",children:"Thank You For Your Patronage!"}),e.jsx("div",{className:"mt-3 text-[10px] text-gray-400 print:mt-2 print:text-[10px] print:text-black",children:"*** INSTANT PAYMENT ***"})]}),e.jsxs("div",{className:"mt-6 flex gap-3 print:hidden",children:[e.jsxs(C,{onClick:p,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Print Receipt"]}),e.jsxs(C,{onClick:N,variant:"outline",className:"flex-1",children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Close"]})]})]})})},Ae=({searchTerm:d,onSearchChange:N})=>e.jsx("div",{className:"mb-4 flex items-center space-x-2",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ue,{className:"text-muted-foreground absolute top-2.5 left-2 h-4 w-4"}),e.jsx(k,{placeholder:"Search by Transaction ID, Customer, or Product...",value:d,onChange:p=>N(p.target.value),className:"pl-8"})]})}),Oe=({sales_transactions:d,onEdit:N})=>{const[p,y]=o.useState(null),[r,h]=o.useState(null),[v,t]=o.useState(""),j=new Date().toISOString().slice(0,10),F=new Date(Date.now()-2880*60*1e3).toISOString().slice(0,10),[w,u]=o.useState(F),[P,S]=o.useState(j),R=d.current_page,_=o.useCallback(Ce.debounce((s,c,l,f)=>{se.get(route("sales-transactions.index"),{search:s,start_date:c,end_date:l,page:f},{preserveState:!0,preserveScroll:!0,replace:!0})},500),[]);o.useEffect(()=>{_(v,w,P,R)},[v,w,P,R,_]);const n=(s,c)=>{c==="start"?u(s):S(s)},m=s=>{window.confirm("Are you sure you want to delete this transaction?")&&se.delete(route("sales-transactions.destroy",s))},x=s=>{y(s),s.status==="Completed"&&parseFloat(s.amount_owed)===0?h("instant"):h("credit")},b=()=>{y(null),h(null)};return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{startDate:w,endDate:P,onChange:n}),e.jsxs($,{children:[e.jsxs(Q,{children:[e.jsx(K,{children:"Sales Transactions"}),e.jsx(Ae,{searchTerm:v,onSearchChange:t})]}),e.jsxs(W,{children:[e.jsxs(ke,{children:[e.jsx(Fe,{children:e.jsxs(ne,{children:[e.jsx(T,{children:"Transaction ID"}),e.jsx(T,{children:"Date"}),e.jsx(T,{children:"Customer"}),e.jsx(T,{children:"Product"}),e.jsx(T,{children:"Quantity"}),e.jsx(T,{children:"Unit Price"}),e.jsx(T,{children:"Total"}),e.jsx(T,{children:"Payment Type"}),e.jsx(T,{children:"Amount Paid"}),e.jsx(T,{children:"Amount Owed"}),e.jsx(T,{children:"Status"}),e.jsx(T,{children:"Actions"})]})}),e.jsx(De,{children:d.data.map(s=>e.jsxs(ne,{children:[e.jsx(A,{className:"font-medium",children:s.id}),e.jsx(A,{children:s.date}),e.jsx(A,{children:s.customer}),e.jsx(A,{children:s.sale_items.map((c,l)=>e.jsx("div",{children:c.product},l))}),e.jsx(A,{children:s.sale_items.map((c,l)=>e.jsx("div",{children:c.quantity},l))}),e.jsx(A,{children:s.sale_items.map((c,l)=>e.jsxs("div",{children:["GH₵",parseFloat(c.unit_selling_price).toFixed(2)]},l))}),e.jsx(A,{className:"font-medium",children:s.sale_items.map((c,l)=>e.jsxs("div",{children:["GH₵",parseFloat(c.total).toFixed(2)]},l))}),e.jsx(A,{children:e.jsx(re,{variant:s.status==="Partial"?"secondary":s.payment_type==="Cash"?"default":"secondary",children:s.status==="Partial"?"Partial":s.payment_type})}),e.jsxs(A,{children:["GH₵",parseFloat(s.amount_paid).toFixed(2)]}),e.jsxs(A,{children:["GH₵",parseFloat(s.amount_owed).toFixed(2)]}),e.jsx(A,{children:e.jsx(re,{variant:s.status==="Completed"?"default":s.status==="Partial"?"secondary":s.status==="Credit"?"outline":"secondary",children:s.status})}),e.jsx(A,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>N&&N(s),className:"text-green-600 hover:text-green-800",children:[e.jsx(he,{className:"mr-1 h-4 w-4"}),"Edit"]}),e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>x(s),className:"text-blue-600 hover:text-blue-800",children:[e.jsx(ye,{className:"mr-1 h-4 w-4"}),"Receipt"]}),e.jsx(C,{variant:"destructive",size:"sm",onClick:()=>m(s.id),className:"text-white",children:"Delete"})]})})]},s.id))})]}),d.data.length===0?e.jsx("div",{className:"text-muted-foreground py-8 text-center",children:"No transactions found matching your search."}):e.jsxs("div",{className:"my-3 flex items-center justify-center gap-4",children:[d.prev_page_url&&e.jsx(ae,{preserveScroll:!0,preserveState:!0,href:d.prev_page_url,className:"rounded border px-4 py-2 hover:bg-gray-100",children:"« Previous"}),e.jsxs("span",{className:"px-4 py-2 font-medium",children:["Page ",d.current_page]}),d.next_page_url&&e.jsx(ae,{preserveScroll:!0,preserveState:!0,href:d.next_page_url,className:"rounded border px-4 py-2 hover:bg-gray-100",children:"Next »"})]})]})]}),p&&r==="instant"&&e.jsx(ge,{transaction:p,onClose:b}),p&&r==="credit"&&e.jsx(be,{transaction:p,onClose:b})]})};function st({sales_transactions:d=[],products:N=[],customers:p=[]}){const[y,r]=o.useState(!1),[h,v]=o.useState(!1),[t,j]=o.useState(null),[F,w]=o.useState([{product_id:"",qty:"",unit_selling_price:"",total:""}]),[u,P]=o.useState(""),[S,R]=o.useState(""),[_,n]=o.useState("cash"),[m,x]=o.useState(!1),[b,s]=o.useState(null),c=ie({customer_id:"",customer_name:"",transaction_date:new Date().toISOString().split("T")[0],items:F,amount_paid:"",due_date:"",payment_type:"cash"});o.useEffect(()=>{c.setData("items",F)},[F]),o.useEffect(()=>{c.setData("amount_paid",u)},[u]),o.useEffect(()=>{c.setData("due_date",S)},[S]),o.useEffect(()=>{c.setData("payment_type",_)},[_]);const l=F.reduce((i,M)=>i+(parseFloat(M.total)||0),0);o.useEffect(()=>{_==="cash"&&(P(l.toString()),c.setError("amount_paid",void 0)),_==="credit"&&(P("0"),c.setError("amount_paid",void 0))},[_,l]);const f=()=>{w([{product_id:"",qty:"",unit_selling_price:"",total:""}]),P(""),R(""),n("cash"),c.reset(),c.setData({customer_id:"",customer_name:"",transaction_date:new Date().toISOString().split("T")[0],items:[{product_id:"",qty:"",unit_selling_price:"",total:""}],amount_paid:"",due_date:"",payment_type:"cash"}),r(!0)},I=()=>{r(!1),w([{product_id:"",qty:"",unit_selling_price:"",total:""}]),P(""),R(""),n("cash"),c.reset(),c.setData({customer_id:"",customer_name:"",transaction_date:new Date().toISOString().split("T")[0],items:[{product_id:"",qty:"",unit_selling_price:"",total:""}],amount_paid:"",due_date:"",payment_type:"cash"})},q=i=>{j(i),v(!0)},L=()=>{v(!1),j(null)},H=i=>{s(i),x(!0)},a=()=>{x(!1),s(null)},g=[{title:"Sales Transactions",href:"/sales-transactions"}],E=d.data.filter(i=>i.status==="Completed").reduce((i,M)=>i+parseFloat(M.amount_paid),0),G=d.data.filter(i=>i.payment_type==="Credit").reduce((i,M)=>i+parseFloat(M.total),0)+d.data.filter(i=>i.payment_type==="Partial").reduce((i,M)=>i+parseFloat(M.amount_owed),0);return e.jsx(ve,{breadcrumbs:g,children:e.jsxs("div",{className:"min-h-screen space-y-6 bg-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Sales & Transactions"}),e.jsx(C,{onClick:f,children:"Add Transaction"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[e.jsxs($,{children:[e.jsx(Q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Total Sales"})}),e.jsxs(W,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["GH₵",(E+G).toFixed(2)]}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"All transactions"})]})]}),e.jsxs($,{children:[e.jsx(Q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Cash Sales"})}),e.jsxs(W,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["GH₵",E.toFixed(2)]}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Cash payments"})]})]}),e.jsxs($,{children:[e.jsx(Q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Credit Sales"})}),e.jsxs(W,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["GH₵",G.toFixed(2)]}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Credit payments"})]})]})]}),e.jsx(Oe,{sales_transactions:d,onEdit:q}),e.jsx(Ie,{open:y,onClose:I,products:N,customers:p,form:c,items:F,setItems:w,amountPaid:u,setAmountPaid:P,dueDate:S,setDueDate:R,paymentType:_,setPaymentType:n,runningTotal:l,onSaleSuccess:H}),e.jsx(Te,{open:h,onClose:L,transaction:t,products:N,customers:p}),m&&b&&(b.status==="Completed"&&parseFloat(b.amount_owed)===0?e.jsx(ge,{transaction:b,onClose:a}):e.jsx(be,{transaction:b,onClose:a}))]})})}export{st as default};
