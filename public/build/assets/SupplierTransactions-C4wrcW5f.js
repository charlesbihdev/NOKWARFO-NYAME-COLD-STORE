import{r as y,u as Ne,j as e,a as v,L as U}from"./app-Bicvdzaq.js";import{B as ve}from"./badge-BBoBq8_m.js";import{F as c}from"./createLucideIcon-CjhkbSKr.js";import{C as B,c as H,a as be,b as _e}from"./card-7QsND64p.js";import{D as L,b as z,c as G,d as R}from"./dialog-kOxqKTVd.js";import{I as f}from"./index-DuMDjP7Y.js";import{L as m}from"./label-D4Pr0DB7.js";import{T as $}from"./textarea-Cqe5dgg6.js";import{S as Q,a as V,b as Y,c as J,d as C}from"./select-BqvgbUUE.js";import{A as Se,U as we}from"./app-layout-ClZ5XtJB.js";import{D as Ce}from"./DateRangePicker-Bkj6yHNp.js";import{I as b}from"./InputError-u4fE3LEH.js";import{D as K}from"./dollar-sign-G-B9yEso.js";import{S as W}from"./square-pen-umeStPrp.js";import{T as X}from"./trash-2-i6uI8R_s.js";import{P as De}from"./plus-AcRfdIds.js";import"./index-dJniqGDa.js";import"./index-BZN2j33M.js";import"./index-B0wu8Ctx.js";function Ve({supplier:x,transactions:i,start_date:Z="",end_date:ee="",products:D=[]}){const[te,P]=y.useState(!1),[se,_]=y.useState(!1),[n,h]=y.useState(null),[o,p]=y.useState([{product_name:"",quantity:1,unit_price:0}]),[I,k]=y.useState("all"),E=()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),1),r=new Date(t.getFullYear(),t.getMonth()+1,0);return{start:s.toISOString().slice(0,10),end:r.toISOString().slice(0,10)}},{start:ae,end:re}=E(),[T,q]=y.useState(Z||ae),[F,M]=y.useState(ee||re),{data:g,setData:l,post:ne,put:le,processing:S,errors:j,reset:N,clearErrors:w}=Ne({payment_amount:"",payment_date:new Date().toISOString().split("T")[0],payment_method:"",notes:"",transaction_date:"",items:[]}),ie=()=>v.get(route("suppliers.index")),de=(t,s)=>{const r=s==="start"?t:T,a=s==="end"?t:F;s==="start"&&q(t),s==="end"&&M(t),v.get(route("suppliers.transactions",x.id),{start_date:r,end_date:a,status:I,page:1},{preserveState:!0,preserveScroll:!0,replace:!0})},ce=t=>{k(t),v.get(route("suppliers.transactions",x.id),{start_date:T,end_date:F,status:t,page:1},{preserveState:!0,preserveScroll:!0,replace:!0})};function oe(t){h(t),P(!0),N()}function me(t){h(t),_(!0);let s="";t.transaction_date&&(s=new Date(t.transaction_date).toISOString().split("T")[0]);const r=t.items&&t.items.length>0?t.items.map(a=>({product_name:a.product_name,quantity:a.quantity,unit_price:a.unit_price})):[{product_name:"",quantity:1,unit_price:0}];p(r),l({transaction_date:s,notes:t.notes||"",items:r})}function ue(t){confirm("Are you sure you want to delete this transaction? This action cannot be undone.")&&v.delete(route("suppliers.delete-credit-transaction",t),{onSuccess:()=>{h(null)},onError:s=>{s.error?alert("Cannot delete transaction: "+s.error):alert("Failed to delete transaction. Please try again.")},preserveScroll:!0,preserveState:!0,only:["supplier","transactions","errors","flash"]})}function xe(t){t.preventDefault(),n&&ne(route("suppliers.make-payment",n.id),{onSuccess:()=>{P(!1),h(null),N(),w()},preserveScroll:!0,preserveState:!0,only:["supplier","transactions","errors","flash"]})}function he(t){t.preventDefault(),n&&(l({...g,items:o}),le(route("suppliers.update-credit-transaction",n.id),{onSuccess:()=>{_(!1),h(null),p([{product_name:"",quantity:1,unit_price:0}]),N(),w()},preserveScroll:!0,preserveState:!0,only:["supplier","transactions","errors","flash"]}))}function pe(){const t=[...o,{product_name:"",quantity:1,unit_price:0}];p(t),l("items",t)}function ge(t){if(o.length>1){const s=o.filter((r,a)=>a!==t);p(s),l("items",s)}}function O(t,s,r){const a=[...o];a[t]={...a[t],[s]:r},p(a),l("items",a)}function je(t,s){const r=D.find(a=>a.id==s);if(r){const a=[...o];a[t]={...a[t],product_name:r.name,unit_price:r.unit_cost_price||0},p(a),l("items",a)}}function A(){P(!1),h(null),N(),w()}function ye(){_(!1),h(null),p([{product_name:"",quantity:1,unit_price:0}]),N(),w()}function u(t){return`GHC ${(parseFloat(t)||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function fe(t){const s=r=>{switch(r){case"debt":return"bg-red-600 text-white hover:bg-red-700";case"paid":return"bg-green-600 text-white hover:bg-green-700";default:return"bg-gray-600 text-white hover:bg-gray-700"}};return e.jsx(ve,{className:s(t),children:t.toUpperCase()})}return e.jsx(Se,{breadcrumbs:[{title:"Suppliers",href:"/suppliers"},{title:"Transactions"}],children:e.jsxs("div",{className:"min-h-screen space-y-6 bg-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Transactions for ",x.name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Contact: ",x.phone," | Email: ",x.email]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(c,{variant:"outline",onClick:ie,children:"← Back to Suppliers"})})]}),e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Showing Transactions"}),e.jsx("p",{className:"text-2xl font-bold",children:i.data.length})]})]})})}),e.jsxs(B,{children:[e.jsx(be,{children:e.jsx(_e,{children:"Credit Transaction History"})}),e.jsxs(H,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Filters"}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>{const{start:t,end:s}=E();q(t),M(s),k("all"),v.get(route("suppliers.transactions",x.id),{start_date:t,end_date:s,status:"all",page:1},{preserveState:!0,preserveScroll:!0,replace:!0})},children:"Clear Filters"})]}),e.jsxs("div",{children:[e.jsxs(m,{className:"text-sm font-medium text-gray-700 mb-2 block",children:["Date Range ",e.jsx("span",{className:"text-xs text-gray-500",children:"(Default: Current Month)"})]}),e.jsx(Ce,{startDate:T,endDate:F,onChange:de})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"status-filter",className:"text-sm font-medium text-gray-700 mb-2 block",children:"Status Filter"}),e.jsxs(Q,{value:I,onValueChange:ce,children:[e.jsx(V,{className:"w-48",children:e.jsx(Y,{placeholder:"All Statuses"})}),e.jsxs(J,{children:[e.jsx(C,{value:"all",children:"All Transactions"}),e.jsx(C,{value:"debt",children:"Debt (Unpaid/Partial)"}),e.jsx(C,{value:"paid",children:"Fully Paid"})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",i.data.length," transactions"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[i.data.map(t=>e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-base font-semibold",children:t.transaction_date}),fe(t.status)]}),e.jsxs("div",{className:"flex gap-2",children:[t.can_make_payment&&e.jsxs(c,{size:"sm",onClick:()=>oe(t),className:"text-green-600",children:[e.jsx(K,{className:"mr-2 h-3 w-3"}),"Make Payment"]}),e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>me(t),children:[e.jsx(W,{className:"mr-2 h-3 w-3"}),"Edit"]}),e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>ue(t.id),className:"text-red-600",children:[e.jsx(X,{className:"mr-2 h-3 w-3"}),"Delete"]})]})]}),t.notes&&e.jsx("div",{className:"mb-3",children:e.jsxs("p",{className:"text-sm text-gray-600 italic",children:['"',t.notes,'"']})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Items Purchased:"}),t.items&&t.items.length>0?e.jsx("div",{className:"overflow-hidden rounded-md border border-gray-200",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-3 text-left font-medium text-gray-700",children:"Product"}),e.jsx("th",{className:"py-2 px-3 text-right font-medium text-gray-700",children:"Qty"}),e.jsx("th",{className:"py-2 px-3 text-right font-medium text-gray-700",children:"Unit Price"}),e.jsx("th",{className:"py-2 px-3 text-right font-medium text-gray-700",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.items.map((s,r)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-3 text-gray-900",children:s.product_name}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-700",children:s.quantity}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-700",children:u(s.unit_price)}),e.jsx("td",{className:"py-2 px-3 text-right font-medium text-gray-900",children:u(s.total_amount||s.quantity*s.unit_price)})]},s.id||r))})]})}):e.jsx("div",{className:"rounded-md border border-gray-200 bg-gray-50 p-3",children:e.jsx("p",{className:"text-sm text-gray-600 italic",children:"No detailed items recorded for this transaction"})})]}),e.jsxs("div",{className:"space-y-1 text-xs mb-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Total Cost:"}),e.jsx("span",{children:u(t.amount_owed)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Payment Made:"}),e.jsx("span",{children:u(t.amount_paid)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Outstanding Balance:"}),e.jsx("span",{className:"font-semibold text-red-600",children:u(t.remaining_balance)})]})]}),t.payments&&t.payments.length>0&&e.jsxs("div",{className:"rounded bg-gray-50 p-2",children:[e.jsx("h4",{className:"mb-1 text-xs font-medium text-gray-700",children:"Payment History:"}),e.jsx("div",{className:"space-y-1",children:t.payments.map(s=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:s.payment_date}),e.jsx("span",{children:u(s.payment_amount)}),s.payment_method&&e.jsxs("span",{className:"text-gray-500",children:["(",s.payment_method,")"]})]},s.id))})]})]},t.id)),i.data.length===0&&e.jsx("div",{className:"py-8 text-center text-gray-500",children:"No credit transactions found for this supplier."})]}),(i.prev_page_url||i.next_page_url)&&e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-4",children:[i.prev_page_url?e.jsx(U,{href:i.prev_page_url,preserveState:!0,preserveScroll:!0,className:"rounded border px-3 py-1 bg-white hover:bg-gray-100",children:"Previous"}):e.jsx("span",{className:"rounded border px-3 py-1 cursor-not-allowed bg-gray-200",children:"Previous"}),e.jsx("span",{className:"rounded border px-3 py-1",children:i.current_page}),i.next_page_url?e.jsx(U,{href:i.next_page_url,preserveState:!0,preserveScroll:!0,className:"rounded border px-3 py-1 bg-white hover:bg-gray-100",children:"Next"}):e.jsx("span",{className:"rounded border px-3 py-1 cursor-not-allowed bg-gray-200",children:"Next"})]})]})]}),e.jsx(L,{open:te,onOpenChange:A,children:e.jsxs(z,{className:"max-h-[85vh] max-w-2xl overflow-y-auto",children:[e.jsx(G,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Make Payment"]})}),e.jsxs("form",{onSubmit:xe,className:"space-y-4",children:[n&&e.jsxs("div",{className:"rounded-lg bg-gray-50 p-3",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Transaction:"})," ",n.description]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Outstanding Balance:"})," ",u(n.remaining_balance)]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"payment_amount",children:"Payment Amount (GHC) *"}),e.jsx(f,{id:"payment_amount",type:"number",step:"0.01",min:"0.01",max:(n==null?void 0:n.remaining_balance)||0,placeholder:"0.00",value:g.payment_amount,onChange:t=>l("payment_amount",t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"payment_date",children:"Payment Date *"}),e.jsx(f,{id:"payment_date",type:"date",value:g.payment_date,onChange:t=>l("payment_date",t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"payment_method",children:"Payment Method"}),e.jsx(f,{id:"payment_method",type:"text",placeholder:"Cash, Bank Transfer, etc.",value:g.payment_method,onChange:t=>l("payment_method",t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"notes",children:"Notes"}),e.jsx($,{id:"notes",placeholder:"Additional payment details",value:g.notes,onChange:t=>l("notes",t.target.value),rows:2})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:A,children:"Cancel"}),e.jsx(c,{type:"submit",disabled:S,children:S?"Processing...":"Record Payment"})]})]})]})}),e.jsx(L,{open:se,onOpenChange:()=>_(!1),children:e.jsxs(z,{className:"max-h-[85vh] max-w-2xl overflow-y-auto",children:[e.jsx(G,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"Edit Transaction"]})}),e.jsxs("form",{onSubmit:he,className:"space-y-4",children:[n&&e.jsxs("div",{className:"rounded-lg bg-gray-50 p-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:["Editing transaction for: ",x.name]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Current Status: ",n.status.toUpperCase()]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit_transaction_date",children:"Transaction Date *"}),e.jsx(f,{id:"edit_transaction_date",type:"date",value:g.transaction_date,onChange:t=>l("transaction_date",t.target.value),required:!0}),e.jsx(b,{message:j.transaction_date})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{children:"Goods Items *"}),e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:pe,className:"h-8",children:[e.jsx(De,{className:"mr-1 h-3 w-3"}),"Add Item"]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-2 px-3 text-xs font-medium text-gray-600",children:[e.jsx("div",{className:"col-span-5",children:"Product Name"}),e.jsx("div",{className:"col-span-3 text-center",children:"Quantity"}),e.jsx("div",{className:"col-span-3 text-center",children:"Unit Price (GHC)"}),e.jsx("div",{className:"col-span-1"})]}),o.map((t,s)=>{var r,a;return e.jsxs("div",{className:"grid grid-cols-12 gap-2 rounded-lg border p-3",children:[e.jsxs("div",{className:"col-span-5",children:[e.jsxs(Q,{value:t.product_name&&((a=(r=D.find(d=>d.name===t.product_name))==null?void 0:r.id)==null?void 0:a.toString())||"",onValueChange:d=>je(s,d),children:[e.jsx(V,{children:e.jsx(Y,{placeholder:"Select a product"})}),e.jsx(J,{children:D.map(d=>e.jsx(C,{value:d.id.toString(),children:d.name},d.id))})]}),e.jsx(b,{message:j[`items.${s}.product_name`],className:"mt-1"})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(f,{type:"number",placeholder:"Qty",value:t.quantity,onChange:d=>O(s,"quantity",d.target.value),min:"1",required:!0}),e.jsx(b,{message:j[`items.${s}.quantity`],className:"mt-1"})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(f,{type:"number",step:"0.01",placeholder:"Unit Price",value:t.unit_price,onChange:d=>O(s,"unit_price",d.target.value),min:"0.01",required:!0}),e.jsx(b,{message:j[`items.${s}.unit_price`],className:"mt-1"})]}),e.jsx("div",{className:"col-span-1",children:o.length>1&&e.jsx(c,{type:"button",variant:"outline",size:"sm",onClick:()=>ge(s),className:"h-8 w-8 p-0 text-red-600",children:e.jsx(X,{className:"h-3 w-3"})})})]},s)})]}),e.jsx("div",{className:"rounded-lg bg-blue-50 p-3",children:e.jsxs("div",{className:"flex justify-between text-sm font-medium",children:[e.jsx("span",{children:"Total Amount:"}),e.jsxs("span",{className:"text-blue-600",children:["GHC ",o.reduce((t,s)=>t+parseFloat(s.quantity||0)*parseFloat(s.unit_price||0),0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit_notes",children:"Notes"}),e.jsx($,{id:"edit_notes",placeholder:"Additional information about this transaction",value:g.notes,onChange:t=>l("notes",t.target.value),rows:3}),e.jsx(b,{message:j.notes})]}),n&&n.payments&&n.payments.length>0&&e.jsx("div",{className:"rounded-lg bg-amber-50 p-3 border border-amber-200",children:e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("strong",{children:"Note:"})," This transaction has payments totaling ",u(n.payments.reduce((t,s)=>t+parseFloat(s.amount),0)),". You can edit items but the new total amount must be at least the amount already paid."]})}),Object.keys(j).length>0&&e.jsx("div",{className:"rounded-md bg-red-50 p-4 border border-red-200",children:e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"There were errors with your submission"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("ul",{className:"list-disc pl-5 space-y-1",children:Object.entries(j).map(([t,s])=>e.jsx("li",{children:s},t))})})]})})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:ye,children:"Cancel"}),e.jsx(c,{type:"submit",disabled:S,children:S?"Updating...":"Update Transaction"})]})]})]})})]})})}export{Ve as default};
