import{r as g,u as xe,j as e,a as N,L as O}from"./app-1Notxd3e.js";import{B as he}from"./badge-C5cK0jYn.js";import{F as d}from"./createLucideIcon-B7W1q_uQ.js";import{C as A,c as U,a as pe,b as ge}from"./card-DfvEkdop.js";import{D as B,b as H,c as L,d as z}from"./dialog-Dx9yVP87.js";import{I as j}from"./index-Xk3s--Yf.js";import{L as c}from"./label-Brq_mziV.js";import{T as G}from"./textarea-640VWfOb.js";import{S as je,a as ye,b as fe,c as Ne,d as F}from"./select-B8ZnsxfS.js";import{A as ve,U as be}from"./app-layout-DP6IZWd4.js";import{D as _e}from"./DateRangePicker-DxtaA00k.js";import{I as v}from"./InputError-CYqUW_vg.js";import{D as R}from"./dollar-sign-QtGlXpc0.js";import{S as $}from"./square-pen-D_U6rt0r.js";import{T as Q}from"./trash-2-DYDRsOaj.js";import{P as Se}from"./plus-6p939pSQ.js";import"./index-BxglnvVj.js";import"./index-BIqwGjeY.js";import"./index-C4amr-KH.js";function Re({supplier:u,transactions:l,start_date:Y="",end_date:V=""}){const[J,w]=g.useState(!1),[K,b]=g.useState(!1),[r,x]=g.useState(null),[o,y]=g.useState([{product_name:"",quantity:1,unit_price:0}]),[T,I]=g.useState("all"),k=()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),1),a=new Date(t.getFullYear(),t.getMonth()+1,0);return{start:s.toISOString().slice(0,10),end:a.toISOString().slice(0,10)}},{start:W,end:X}=k(),[C,E]=g.useState(Y||W),[D,q]=g.useState(V||X),{data:h,setData:i,post:Z,put:ee,processing:_,errors:p,reset:f,clearErrors:S}=xe({payment_amount:"",payment_date:new Date().toISOString().split("T")[0],payment_method:"",notes:"",transaction_date:"",items:[]}),te=()=>N.get(route("suppliers.index")),se=(t,s)=>{const a=s==="start"?t:C,n=s==="end"?t:D;s==="start"&&E(t),s==="end"&&q(t),N.get(route("suppliers.transactions",u.id),{start_date:a,end_date:n,status:T,page:1},{preserveState:!0,preserveScroll:!0,replace:!0})},ae=t=>{I(t),N.get(route("suppliers.transactions",u.id),{start_date:C,end_date:D,status:t,page:1},{preserveState:!0,preserveScroll:!0,replace:!0})};function re(t){x(t),w(!0),f()}function ne(t){x(t),b(!0);let s="";t.transaction_date&&(s=new Date(t.transaction_date).toISOString().split("T")[0]);const a=t.items&&t.items.length>0?t.items.map(n=>({product_name:n.product_name,quantity:n.quantity,unit_price:n.unit_price})):[{product_name:"",quantity:1,unit_price:0}];y(a),i({transaction_date:s,notes:t.notes||"",items:a})}function le(t){confirm("Are you sure you want to delete this transaction? This action cannot be undone.")&&N.delete(route("suppliers.delete-credit-transaction",t),{onSuccess:()=>{x(null)},onError:s=>{s.error?alert("Cannot delete transaction: "+s.error):alert("Failed to delete transaction. Please try again.")},preserveScroll:!0,preserveState:!0,only:["supplier","transactions","errors","flash"]})}function ie(t){t.preventDefault(),r&&Z(route("suppliers.make-payment",r.id),{onSuccess:()=>{w(!1),x(null),f(),S()},preserveScroll:!0,preserveState:!0,only:["supplier","transactions","errors","flash"]})}function de(t){t.preventDefault(),r&&(i({...h,items:o}),ee(route("suppliers.update-credit-transaction",r.id),{onSuccess:()=>{b(!1),x(null),y([{product_name:"",quantity:1,unit_price:0}]),f(),S()},preserveScroll:!0,preserveState:!0,only:["supplier","transactions","errors","flash"]}))}function ce(){const t=[...o,{product_name:"",quantity:1,unit_price:0}];y(t),i("items",t)}function oe(t){if(o.length>1){const s=o.filter((a,n)=>n!==t);y(s),i("items",s)}}function P(t,s,a){const n=[...o];n[t]={...n[t],[s]:a},y(n),i("items",n)}function M(){w(!1),x(null),f(),S()}function me(){b(!1),x(null),y([{product_name:"",quantity:1,unit_price:0}]),f(),S()}function m(t){return`GHC ${(parseFloat(t)||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function ue(t){const s=a=>{switch(a){case"debt":return"bg-red-600 text-white hover:bg-red-700";case"paid":return"bg-green-600 text-white hover:bg-green-700";default:return"bg-gray-600 text-white hover:bg-gray-700"}};return e.jsx(he,{className:s(t),children:t.toUpperCase()})}return e.jsx(ve,{breadcrumbs:[{title:"Suppliers",href:"/suppliers"},{title:"Transactions"}],children:e.jsxs("div",{className:"min-h-screen space-y-6 bg-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Transactions for ",u.name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Contact: ",u.phone," | Email: ",u.email]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(d,{variant:"outline",onClick:te,children:"â† Back to Suppliers"})})]}),e.jsx(A,{children:e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Showing Transactions"}),e.jsx("p",{className:"text-2xl font-bold",children:l.data.length})]})]})})}),e.jsxs(A,{children:[e.jsx(pe,{children:e.jsx(ge,{children:"Credit Transaction History"})}),e.jsxs(U,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Filters"}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{const{start:t,end:s}=k();E(t),q(s),I("all"),N.get(route("suppliers.transactions",u.id),{start_date:t,end_date:s,status:"all",page:1},{preserveState:!0,preserveScroll:!0,replace:!0})},children:"Clear Filters"})]}),e.jsxs("div",{children:[e.jsxs(c,{className:"text-sm font-medium text-gray-700 mb-2 block",children:["Date Range ",e.jsx("span",{className:"text-xs text-gray-500",children:"(Default: Current Month)"})]}),e.jsx(_e,{startDate:C,endDate:D,onChange:se})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"status-filter",className:"text-sm font-medium text-gray-700 mb-2 block",children:"Status Filter"}),e.jsxs(je,{value:T,onValueChange:ae,children:[e.jsx(ye,{className:"w-48",children:e.jsx(fe,{placeholder:"All Statuses"})}),e.jsxs(Ne,{children:[e.jsx(F,{value:"all",children:"All Transactions"}),e.jsx(F,{value:"debt",children:"Debt (Unpaid/Partial)"}),e.jsx(F,{value:"paid",children:"Fully Paid"})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",l.data.length," transactions"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[l.data.map(t=>e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-base font-semibold",children:t.transaction_date}),ue(t.status)]}),e.jsxs("div",{className:"flex gap-2",children:[t.can_make_payment&&e.jsxs(d,{size:"sm",onClick:()=>re(t),className:"text-green-600",children:[e.jsx(R,{className:"mr-2 h-3 w-3"}),"Make Payment"]}),e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>ne(t),children:[e.jsx($,{className:"mr-2 h-3 w-3"}),"Edit"]}),e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>le(t.id),className:"text-red-600",children:[e.jsx(Q,{className:"mr-2 h-3 w-3"}),"Delete"]})]})]}),t.notes&&e.jsx("div",{className:"mb-3",children:e.jsxs("p",{className:"text-sm text-gray-600 italic",children:['"',t.notes,'"']})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Items Purchased:"}),t.items&&t.items.length>0?e.jsx("div",{className:"overflow-hidden rounded-md border border-gray-200",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-3 text-left font-medium text-gray-700",children:"Product"}),e.jsx("th",{className:"py-2 px-3 text-right font-medium text-gray-700",children:"Qty"}),e.jsx("th",{className:"py-2 px-3 text-right font-medium text-gray-700",children:"Unit Price"}),e.jsx("th",{className:"py-2 px-3 text-right font-medium text-gray-700",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.items.map((s,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-3 text-gray-900",children:s.product_name}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-700",children:s.quantity}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-700",children:m(s.unit_price)}),e.jsx("td",{className:"py-2 px-3 text-right font-medium text-gray-900",children:m(s.total_amount||s.quantity*s.unit_price)})]},s.id||a))})]})}):e.jsx("div",{className:"rounded-md border border-gray-200 bg-gray-50 p-3",children:e.jsx("p",{className:"text-sm text-gray-600 italic",children:"No detailed items recorded for this transaction"})})]}),e.jsxs("div",{className:"space-y-1 text-xs mb-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Total Cost:"}),e.jsx("span",{children:m(t.amount_owed)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Payment Made:"}),e.jsx("span",{children:m(t.amount_paid)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Outstanding Balance:"}),e.jsx("span",{className:"font-semibold text-red-600",children:m(t.remaining_balance)})]})]}),t.payments&&t.payments.length>0&&e.jsxs("div",{className:"rounded bg-gray-50 p-2",children:[e.jsx("h4",{className:"mb-1 text-xs font-medium text-gray-700",children:"Payment History:"}),e.jsx("div",{className:"space-y-1",children:t.payments.map(s=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:s.payment_date}),e.jsx("span",{children:m(s.payment_amount)}),s.payment_method&&e.jsxs("span",{className:"text-gray-500",children:["(",s.payment_method,")"]})]},s.id))})]})]},t.id)),l.data.length===0&&e.jsx("div",{className:"py-8 text-center text-gray-500",children:"No credit transactions found for this supplier."})]}),(l.prev_page_url||l.next_page_url)&&e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-4",children:[l.prev_page_url?e.jsx(O,{href:l.prev_page_url,preserveState:!0,preserveScroll:!0,className:"rounded border px-3 py-1 bg-white hover:bg-gray-100",children:"Previous"}):e.jsx("span",{className:"rounded border px-3 py-1 cursor-not-allowed bg-gray-200",children:"Previous"}),e.jsx("span",{className:"rounded border px-3 py-1",children:l.current_page}),l.next_page_url?e.jsx(O,{href:l.next_page_url,preserveState:!0,preserveScroll:!0,className:"rounded border px-3 py-1 bg-white hover:bg-gray-100",children:"Next"}):e.jsx("span",{className:"rounded border px-3 py-1 cursor-not-allowed bg-gray-200",children:"Next"})]})]})]}),e.jsx(B,{open:J,onOpenChange:M,children:e.jsxs(H,{className:"max-h-[85vh] max-w-2xl overflow-y-auto",children:[e.jsx(L,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Make Payment"]})}),e.jsxs("form",{onSubmit:ie,className:"space-y-4",children:[r&&e.jsxs("div",{className:"rounded-lg bg-gray-50 p-3",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Transaction:"})," ",r.description]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("strong",{children:"Outstanding Balance:"})," ",m(r.remaining_balance)]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"payment_amount",children:"Payment Amount (GHC) *"}),e.jsx(j,{id:"payment_amount",type:"number",step:"0.01",min:"0.01",max:(r==null?void 0:r.remaining_balance)||0,placeholder:"0.00",value:h.payment_amount,onChange:t=>i("payment_amount",t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"payment_date",children:"Payment Date *"}),e.jsx(j,{id:"payment_date",type:"date",value:h.payment_date,onChange:t=>i("payment_date",t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"payment_method",children:"Payment Method"}),e.jsx(j,{id:"payment_method",type:"text",placeholder:"Cash, Bank Transfer, etc.",value:h.payment_method,onChange:t=>i("payment_method",t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"notes",children:"Notes"}),e.jsx(G,{id:"notes",placeholder:"Additional payment details",value:h.notes,onChange:t=>i("notes",t.target.value),rows:2})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(d,{type:"button",variant:"outline",onClick:M,children:"Cancel"}),e.jsx(d,{type:"submit",disabled:_,children:_?"Processing...":"Record Payment"})]})]})]})}),e.jsx(B,{open:K,onOpenChange:()=>b(!1),children:e.jsxs(H,{className:"max-h-[85vh] max-w-2xl overflow-y-auto",children:[e.jsx(L,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Edit Transaction"]})}),e.jsxs("form",{onSubmit:de,className:"space-y-4",children:[r&&e.jsxs("div",{className:"rounded-lg bg-gray-50 p-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:["Editing transaction for: ",u.name]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Current Status: ",r.status.toUpperCase()]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit_transaction_date",children:"Transaction Date *"}),e.jsx(j,{id:"edit_transaction_date",type:"date",value:h.transaction_date,onChange:t=>i("transaction_date",t.target.value),required:!0}),e.jsx(v,{message:p.transaction_date})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{children:"Goods Items *"}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:ce,className:"h-8",children:[e.jsx(Se,{className:"mr-1 h-3 w-3"}),"Add Item"]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-2 px-3 text-xs font-medium text-gray-600",children:[e.jsx("div",{className:"col-span-5",children:"Product Name"}),e.jsx("div",{className:"col-span-3 text-center",children:"Quantity"}),e.jsx("div",{className:"col-span-3 text-center",children:"Unit Price (GHC)"}),e.jsx("div",{className:"col-span-1"})]}),o.map((t,s)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 rounded-lg border p-3",children:[e.jsxs("div",{className:"col-span-5",children:[e.jsx(j,{placeholder:"Product name (e.g., Fish, Meat)",value:t.product_name,onChange:a=>P(s,"product_name",a.target.value),required:!0}),e.jsx(v,{message:p[`items.${s}.product_name`],className:"mt-1"})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(j,{type:"number",placeholder:"Qty",value:t.quantity,onChange:a=>P(s,"quantity",a.target.value),min:"1",required:!0}),e.jsx(v,{message:p[`items.${s}.quantity`],className:"mt-1"})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(j,{type:"number",step:"0.01",placeholder:"Unit Price",value:t.unit_price,onChange:a=>P(s,"unit_price",a.target.value),min:"0.01",required:!0}),e.jsx(v,{message:p[`items.${s}.unit_price`],className:"mt-1"})]}),e.jsx("div",{className:"col-span-1",children:o.length>1&&e.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:()=>oe(s),className:"h-8 w-8 p-0 text-red-600",children:e.jsx(Q,{className:"h-3 w-3"})})})]},s))]}),e.jsx("div",{className:"rounded-lg bg-blue-50 p-3",children:e.jsxs("div",{className:"flex justify-between text-sm font-medium",children:[e.jsx("span",{children:"Total Amount:"}),e.jsxs("span",{className:"text-blue-600",children:["GHC ",o.reduce((t,s)=>t+parseFloat(s.quantity||0)*parseFloat(s.unit_price||0),0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"edit_notes",children:"Notes"}),e.jsx(G,{id:"edit_notes",placeholder:"Additional information about this transaction",value:h.notes,onChange:t=>i("notes",t.target.value),rows:3}),e.jsx(v,{message:p.notes})]}),r&&r.payments&&r.payments.length>0&&e.jsx("div",{className:"rounded-lg bg-amber-50 p-3 border border-amber-200",children:e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("strong",{children:"Note:"})," This transaction has payments totaling ",m(r.payments.reduce((t,s)=>t+parseFloat(s.amount),0)),". You can edit items but the new total amount must be at least the amount already paid."]})}),Object.keys(p).length>0&&e.jsx("div",{className:"rounded-md bg-red-50 p-4 border border-red-200",children:e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"There were errors with your submission"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("ul",{className:"list-disc pl-5 space-y-1",children:Object.entries(p).map(([t,s])=>e.jsx("li",{children:s},t))})})]})})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(d,{type:"button",variant:"outline",onClick:me,children:"Cancel"}),e.jsx(d,{type:"submit",disabled:_,children:_?"Updating...":"Update Transaction"})]})]})]})})]})})}export{Re as default};
