import{j as e,u as q,r as N,a as O}from"./app-B_kQv4aY.js";import{g as R,A as le}from"./app-layout-DX9L-Y6w.js";import{I as b}from"./input-B2iTHLCI.js";import{F as S}from"./createLucideIcon-C5ljYmur.js";import{D as T,b as D,c as L,d as F,e as $}from"./dialog-BZc2kcxj.js";import{L as x}from"./label-C5hnfgCk.js";import{I as C}from"./InputError-HHm-SZMK.js";import{T as z}from"./textarea-D5nEHE1b.js";import{C as M,a as U,b as H,c as Q}from"./card-e5Aik1wQ.js";import{T as B,a as G,b as A,c as h,d as J,e as u}from"./table-CBhLVvf8.js";import{S as re}from"./square-pen-CPp8ROIq.js";import{T as ie}from"./trash-2-DFISG06M.js";import"./index-CFl9bjSW.js";import"./index-BTwFlrjG.js";function ne({isOpen:c,onClose:r,selectedProduct:t,data:s,setData:a,errors:i,processing:m,onSubmit:y}){return e.jsx(T,{open:c,onOpenChange:r,children:e.jsxs(D,{className:"max-w-2xl",children:[e.jsx(L,{children:e.jsxs(F,{children:["Add Stock for ",t==null?void 0:t.name]})}),e.jsxs("form",{onSubmit:y,className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(x,{htmlFor:"date",className:"text-right",children:"Date"}),e.jsx("div",{className:"col-span-3",children:e.jsx(b,{id:"date",type:"date",value:s.date||new Date().toISOString().split("T")[0],onChange:o=>a("date",o.target.value),required:!0})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(x,{htmlFor:"quantity",className:"text-right",children:"Quantity *"}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(b,{id:"quantity",type:"text",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:s.quantity,onChange:o=>a("quantity",o.target.value),required:!0}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:"Format: 5C2L = 5 cartons + 2 lines, 10C = 10 cartons, 15L = 15 lines, or just a number"}),i.quantity&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:i.quantity})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(x,{htmlFor:"notes",className:"text-right",children:"Notes"}),e.jsx("div",{className:"col-span-3",children:e.jsx(b,{id:"notes",placeholder:"Optional notes",value:s.notes,onChange:o=>a("notes",o.target.value)})})]}),e.jsx(S,{type:"submit",disabled:m,children:"Add Stock"})]})]})})}function de({isOpen:c,onClose:r,selectedProduct:t,errors:s={}}){const{data:a,setData:i,post:m,processing:y,reset:o,clearErrors:p,errors:_}=q({product_id:"",date:new Date().toISOString().split("T")[0],available_stock_target:"",received_today_target:"",notes:"",current_system_stock:""}),l={...s,..._};N.useEffect(()=>{c&&t&&(o(),p(),i({product_id:t.id,date:new Date().toISOString().split("T")[0],available_stock_target:"",received_today_target:"",notes:"",current_system_stock:t.current_stock_display||"0"}))},[c,t,o,p]);function d(n){n.preventDefault(),m(route("stock-control.adjust"),{onSuccess:()=>{o(),p(),r()},preserveScroll:!0,preserveState:!0,only:["products","stock_movements","stock_activity_summary","errors","flash"]})}function f(){o(),p(),r()}return t?e.jsx(T,{open:c,onOpenChange:f,children:e.jsxs(D,{className:"max-w-2xl",children:[e.jsx(L,{children:e.jsxs(F,{children:["Stock Adjustment for ",t.name]})}),e.jsxs("form",{onSubmit:d,className:"grid gap-4 py-4",children:[l.adjustment&&e.jsx("div",{className:"rounded-md bg-red-50 p-4 border border-red-200",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Adjustment Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:l.adjustment})]})]})}),e.jsx("input",{type:"hidden",name:"product_id",value:a.product_id}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(x,{htmlFor:"date",className:"text-right",children:"Date"}),e.jsx("div",{className:"col-span-3",children:e.jsx(b,{id:"date",type:"date",value:a.date,onChange:n=>i("date",n.target.value),required:!0})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(x,{htmlFor:"available_stock_target",className:"text-right",children:"Set Available Stock (as of date)"}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(b,{id:"available_stock_target",type:"text",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:a.available_stock_target,onChange:n=>i("available_stock_target",n.target.value)}),l.available_stock_target&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:l.available_stock_target})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(x,{htmlFor:"received_today_target",className:"text-right",children:"Set Stock Received today (for date)"}),e.jsxs("div",{className:"col-span-3",children:[e.jsx(b,{id:"received_today_target",type:"text",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:a.received_today_target,onChange:n=>i("received_today_target",n.target.value)}),l.received_today_target&&e.jsx("div",{className:"mt-1 text-xs text-red-500",children:l.received_today_target})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(x,{htmlFor:"notes",className:"text-right",children:"Notes"}),e.jsx("div",{className:"col-span-3",children:e.jsx(b,{id:"notes",placeholder:"Additional details about this adjustment",value:a.notes,onChange:n=>i("notes",n.target.value)})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(x,{className:"text-right",children:"Info"}),e.jsx("div",{className:"col-span-3",children:e.jsx("div",{className:"p-3 bg-blue-50 rounded border",children:e.jsx("div",{className:"text-sm text-gray-600",children:"Fill any field you want to set for the selected date. The system will compute adjustments to sync to those targets."})})})]}),e.jsx(S,{type:"submit",disabled:y,children:y?"Processing...":"Apply Adjustment"})]})]})}):null}function ce({isOpen:c,onClose:r,stockMovement:t,products:s,errors:a={}}){const{data:i,setData:m,put:y,processing:o,reset:p}=q({product_id:"",quantity:"",notes:""});N.useEffect(()=>{var l;if(t){const d=(f,n)=>{if(n<=1)return f.toString();const g=Math.floor(f/n),v=f%n;return g>0&&v>0?`${g}C${v}L`:g>0?`${g}C`:v>0?`${v}L`:"0"};m({product_id:t.product_id||"",quantity:d(t.quantity,((l=t.product)==null?void 0:l.lines_per_carton)||1),notes:t.notes||""})}},[t]);function _(){t&&y(route("stock-control.update",t.id),{onSuccess:()=>{p(),r()},preserveScroll:!0,preserveState:!0,only:["stock_movements","stock_activity_summary","errors","flash"]})}return!t||t.type!=="received"?null:e.jsx(T,{open:c,onOpenChange:r,children:e.jsxs(D,{className:"max-h-[90vh] max-w-2xl overflow-y-auto",children:[e.jsxs(L,{children:[e.jsx(F,{children:"Edit Stock Movement"}),e.jsx($,{children:"Update the stock movement information. All fields marked with * are required."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-product-id",children:"Product *"}),e.jsxs("select",{id:"edit-product-id",value:i.product_id,onChange:l=>m("product_id",l.target.value),required:!0,className:"w-full rounded border px-3 py-2",children:[e.jsx("option",{value:"",children:"Select product"}),s.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),a.product_id&&e.jsx(C,{message:a.product_id,className:"mt-1"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-type",children:"Type"}),e.jsx("div",{className:"w-full rounded border px-3 py-2 bg-gray-50 text-gray-700",children:"Stock In (Received)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-quantity",children:"Quantity * (Format: 5C2L for 5 cartons + 2 lines)"}),e.jsx(b,{id:"edit-quantity",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:i.quantity,onChange:l=>m("quantity",l.target.value),required:!0}),a.quantity&&e.jsx(C,{message:a.quantity,className:"mt-1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(z,{id:"edit-notes",placeholder:"Additional notes about this stock movement",value:i.notes,onChange:l=>m("notes",l.target.value),rows:3}),a.notes&&e.jsx(C,{message:a.notes,className:"mt-1"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(S,{type:"button",variant:"outline",onClick:r,children:"Cancel"}),e.jsx(S,{onClick:_,disabled:o,children:o?"Updating...":"Update Stock Movement"})]})]})]})})}function oe({isOpen:c,onClose:r,stockMovement:t,products:s,errors:a={}}){const{data:i,setData:m,put:y,processing:o,reset:p}=q({product_id:"",type:"",quantity:"",notes:""});N.useEffect(()=>{var d;if(t){const f=(n,g)=>{if(g<=1)return n.toString();const v=Math.floor(n/g),k=n%g;return v>0&&k>0?`${v}C${k}L`:v>0?`${v}C`:k>0?`${k}L`:"0"};m({product_id:t.product_id||"",type:t.type||"",quantity:f(t.quantity,((d=t.product)==null?void 0:d.lines_per_carton)||1),notes:t.notes||""})}},[t]);function _(){t&&y(route("stock-control.updateAdjustment",t.id),{onSuccess:()=>{p(),r()},preserveScroll:!0,preserveState:!0,only:["stock_movements","stock_activity_summary","errors","flash"]})}if(!t||!["adjustment_in","adjustment_out"].includes(t.type))return null;const l=t.type==="adjustment_in";return e.jsx(T,{open:c,onOpenChange:r,children:e.jsxs(D,{className:"max-h-[90vh] max-w-2xl overflow-y-auto",children:[e.jsxs(L,{children:[e.jsx(F,{children:"Edit Stock Adjustment"}),e.jsxs($,{children:["Update the ",l?"stock addition":"stock reduction"," information. All fields marked with * are required."]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-product-id",children:"Product *"}),e.jsxs("select",{id:"edit-product-id",value:i.product_id,onChange:d=>m("product_id",d.target.value),required:!0,className:"w-full rounded border px-3 py-2",children:[e.jsx("option",{value:"",children:"Select product"}),s.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]}),a.product_id&&e.jsx(C,{message:a.product_id,className:"mt-1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-type",children:"Adjustment Type"}),e.jsx("div",{className:`w-full rounded border px-3 py-2 font-medium ${l?"bg-blue-50 text-blue-700 border-blue-200":"bg-yellow-50 text-yellow-700 border-yellow-200"}`,children:l?"➕ Stock Addition":"➖ Stock Reduction"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-quantity",children:"Quantity * (Format: 5C2L for 5 cartons + 2 lines)"}),e.jsx(b,{id:"edit-quantity",placeholder:"e.g., 5C2L, 10C, 15L, or 20",value:i.quantity,onChange:d=>m("quantity",d.target.value),required:!0}),a.quantity&&e.jsx(C,{message:a.quantity,className:"mt-1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(z,{id:"edit-notes",placeholder:"Reason for this stock adjustment",value:i.notes,onChange:d=>m("notes",d.target.value),rows:3}),a.notes&&e.jsx(C,{message:a.notes,className:"mt-1"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(S,{type:"button",variant:"outline",onClick:r,children:"Cancel"}),e.jsx(S,{onClick:_,disabled:o,children:o?"Updating...":"Update Adjustment"})]})]})]})})}function ue({products:c,onAddStock:r,onAdjustStock:t}){return e.jsxs(M,{children:[e.jsx(U,{children:e.jsx(H,{children:"Product Inventoryyyy"})}),e.jsx(Q,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left font-medium",children:"Product Name"}),e.jsx("th",{className:"p-2 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:c.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2 font-medium",children:s.name}),e.jsx("td",{className:"p-2 text-center",children:e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>r(s),children:"Add Stock"}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>t(s),children:"Stock Adjustment"})]})})]},s.id))})]})})})]})}function xe({stock_activity_summary:c,start_date:r,end_date:t}){return e.jsxs("div",{className:"mb-8 rounded-lg bg-white p-6 shadow-sm",children:[e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[e.jsx(R,{className:"h-6 w-6 text-gray-500"}),e.jsxs("h2",{className:"text-2xl font-bold",children:["Product Stock Activity Summary"," ",r&&t?e.jsxs(e.Fragment,{children:["(",new Date(r).toLocaleDateString()," - ",new Date(t).toLocaleDateString(),")"]}):"(Today)"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(B,{children:[e.jsx(G,{children:e.jsxs(A,{children:[e.jsx(h,{children:"Product"}),e.jsx(h,{children:"Stock Received today"}),e.jsx(h,{children:"Available Stock"}),e.jsx(h,{className:"bg-blue-50",children:"Total available stock"}),e.jsx(h,{children:"Cash Sales"}),e.jsx(h,{children:"Credit Sales"}),e.jsx(h,{children:"Partial Sales"}),e.jsx(h,{className:"bg-green-50",children:"Total Sales"}),e.jsx(h,{className:"bg-yellow-50",children:"Remaining Stock"})]})}),e.jsx(J,{children:c.length?c.map((s,a)=>e.jsxs(A,{children:[e.jsx(u,{className:"font-medium",children:s.product}),e.jsx(u,{className:"text-center",children:s.stock_received_today}),e.jsx(u,{className:"text-center",children:s.previous_stock}),e.jsx(u,{className:"bg-blue-50 text-center font-semibold",children:s.total_available}),e.jsx(u,{className:"text-center",children:s.cash_sales}),e.jsx(u,{className:"text-center",children:s.credit_sales}),e.jsx(u,{className:"text-center",children:s.partial_sales}),e.jsx(u,{className:"bg-green-50 text-center font-semibold",children:s.total_sales}),e.jsx(u,{className:"bg-yellow-50 text-center font-semibold",children:s.remaining_stock})]},s.product+a)):e.jsx(A,{children:e.jsx(u,{colSpan:10,className:"text-muted-foreground py-4 text-center",children:"No data for today."})})})]})}),e.jsxs("div",{className:"text-muted-foreground mt-3 flex flex-col gap-1 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block h-4 w-4 rounded-sm border border-blue-100 bg-blue-50"}),e.jsx("span",{children:"Total available stock = Available stock + Stock received + Adjustments"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block h-4 w-4 rounded-sm border border-green-100 bg-green-50"}),e.jsx("span",{children:"Total Sales = Cash Sales + Credit Sales + Partial Sales"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block h-4 w-4 rounded-sm border border-yellow-100 bg-yellow-50"}),e.jsx("span",{children:"Remaining Stock = Total Available - Total Sales"})]})]})]})}function me({stock_movements:c,onDelete:r,onEdit:t}){return e.jsxs(M,{children:[e.jsx(U,{children:e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Stock Movements"]})}),e.jsx(Q,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(B,{children:[e.jsx(G,{children:e.jsxs(A,{children:[e.jsx(h,{children:"Product"}),e.jsx(h,{children:"Type"}),e.jsx(h,{children:"Quantity"}),e.jsx(h,{children:"Notes"}),e.jsx(h,{children:"Date"}),e.jsx(h,{children:"Actions"})]})}),e.jsx(J,{children:c.map(s=>{var a;return e.jsxs(A,{className:s.type.includes("adjustment")?"bg-yellow-50":"bg-green-50",children:[e.jsx(u,{className:"font-medium",children:(a=s.product)==null?void 0:a.name}),e.jsx(u,{children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${s.type==="received"?"bg-green-100 text-green-800":s.type==="adjustment_in"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:s.type==="received"?"Stock In":s.type==="adjustment_in"?"Adjustment In":"Adjustment Out"})}),e.jsx(u,{className:`font-medium ${s.type==="adjustment_out"?"text-yellow-600":"text-green-600"}`,children:s.quantity_display}),e.jsx(u,{children:s.notes}),e.jsx(u,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(u,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>t(s),children:[e.jsx(re,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>r(s.id),children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"Delete"]})]})})]},s.id)})})]})})})]})}function we({stock_movements:c=[],products:r=[],stock_activity_summary:t=[],date:s}){const[a,i]=N.useState(!1),[m,y]=N.useState(!1),[o,p]=N.useState(!1),[_,l]=N.useState(!1),[d,f]=N.useState(null),[n,g]=N.useState(null),{data:v,setData:k,post:K,processing:P,errors:E,reset:V}=q({product_id:"",quantity:"",notes:"",date:new Date().toISOString().split("T")[0]}),[w,W]=N.useState(""),X=[{title:"Stock Control",href:"/stock-control"}];function Y(j){f(j),k({product_id:j.id,quantity:"",notes:"",date:w||new Date().toISOString().split("T")[0]}),i(!0)}function Z(j){f(j),y(!0)}function ee(j){j.preventDefault(),K(route("stock-control.store"),{onSuccess:()=>{V(),i(!1),f(null)},preserveScroll:!0,preserveState:!0,only:["products","stock_movements","stock_activity_summary","errors","flash"]})}function te(j){confirm("Are you sure you want to delete this stock movement?")&&O.delete(route("stock-control.destroy",j),{preserveScroll:!0,preserveState:!0,only:["stock_movements","products","stock_activity_summary","flash"]})}function se(j){g(j),j.type==="received"?(p(!0),l(!1)):["adjustment_in","adjustment_out"].includes(j.type)&&(l(!0),p(!1))}const ae=j=>{const I=j.target.value;W(I),I&&O.get(route("stock-control.index"),{date:I},{preserveState:!0,replace:!0})};return e.jsx(le,{breadcrumbs:X,children:e.jsxs("div",{className:"min-h-screen space-y-6 bg-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm font-medium",children:"As of date"}),e.jsx(b,{type:"date",value:w,onChange:ae,className:"w-auto"})]}),e.jsx(xe,{stock_activity_summary:t,start_date:w,end_date:w}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold",children:"Inventory Management"})}),e.jsx(ue,{products:r,onAddStock:Y,onAdjustStock:Z}),e.jsx(ne,{isOpen:a,onClose:()=>i(!1),selectedProduct:d,data:v,setData:k,errors:E,processing:P,onSubmit:ee}),e.jsx(de,{isOpen:m,onClose:()=>y(!1),selectedProduct:d}),e.jsx(ce,{isOpen:o,onClose:()=>{p(!1),g(null)},stockMovement:n,products:r,errors:E}),e.jsx(oe,{isOpen:_,onClose:()=>{l(!1),g(null)},stockMovement:n,products:r,errors:E}),e.jsx(me,{stock_movements:c,onDelete:te,onEdit:se})]})})}export{we as default};
