import{r as b,j as e,a as u,L as F}from"./app-C36bihvT.js";import{F as x}from"./createLucideIcon-XfsHsazo.js";import{C as j,c as y,a as R,b as V}from"./card-BHrraKyP.js";import{L as g}from"./label-pihz-xdu.js";import{A as H,U as $}from"./app-layout-GngZEOIY.js";import{D as G}from"./DateRangePicker-BWEtZOf1.js";import{T as k}from"./trash-2-DMjLKetb.js";import{S as Y}from"./square-pen-CebnPhvI.js";import"./index-DFXOyceB.js";import"./index-BUfac13D.js";function de({supplier:l,transactions:r,payments:c=[],start_date:o="",end_date:m="",products:Q=[],errors:J={}}){var T;const w=()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),1),d=new Date(t.getFullYear(),t.getMonth()+1,0);return{start:s.toISOString().slice(0,10),end:d.toISOString().slice(0,10)}},{start:E,end:M}=w(),[D,S]=b.useState(o||E),[P,C]=b.useState(m||M),[O,v]=b.useState(!1),[h,_]=b.useState(null),A=()=>u.get(route("suppliers.index")),B=(t,s)=>{const d=s==="start"?t:D,n=s==="end"?t:P;s==="start"&&S(t),s==="end"&&C(t),u.get(route("suppliers.transactions",l.id),{start_date:d,end_date:n,page:1},{preserveState:!0,preserveScroll:!0,replace:!0})};function L(t){confirm("Are you sure you want to delete this transaction? This action cannot be undone.")&&u.delete(route("suppliers.delete-credit-transaction",t),{onSuccess:()=>{},onError:s=>{s.error?alert("Cannot delete transaction: "+s.error):alert("Failed to delete transaction. Please try again.")},preserveScroll:!0,preserveState:!0,only:["supplier","transactions","errors","flash"]})}function I(t){_(t),v(!0)}function q(t){confirm("Are you sure you want to delete this payment? This action cannot be undone.")&&u.delete(route("suppliers.delete-payment",t),{onSuccess:()=>{},onError:s=>{s.error?alert("Cannot delete payment: "+s.error):alert("Failed to delete payment. Please try again.")},preserveScroll:!0,preserveState:!0,only:["supplier","transactions","payments","errors","flash"]})}function a(t){return`GHC ${(parseFloat(t)||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function i(t){if(!t||typeof t!="string")return null;const s=t.split("-").map(Number);if(s.length!==3||s.some(isNaN)){const N=new Date(t);return isNaN(N)?null:N}const[d,n,p]=s;return new Date(d,n-1,p)}function f(t){if(!t)return"";const s=t instanceof Date?t:new Date(t);return isNaN(s)?"":s.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}return e.jsxs(H,{breadcrumbs:[{title:"Suppliers",href:"/suppliers"},{title:"Transactions"}],children:[e.jsxs("div",{className:"min-h-screen space-y-6 bg-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold",children:["Transactions for ",l.name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Contact: ",l.phone," | Email: ",l.email]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(x,{variant:"outline",onClick:A,children:"← Back to Suppliers"})})]}),e.jsxs("div",{className:"space-y-4",children:[o&&m&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-700",children:["📅 Showing data for: ",e.jsx("span",{className:"font-medium",children:f(i(o))})," to ",e.jsx("span",{className:"font-medium",children:f(i(m))})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(j,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:o&&m?"Filtered Transactions":"Total Transactions"}),e.jsx("p",{className:"text-2xl font-bold",children:l.transactions_count||0})]})]})})}),e.jsx(j,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"h-5 w-5 bg-red-500 rounded-full"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:o&&m?"Filtered Debt":"Total Debt"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:a(l.total_owed||0)})]})]})})}),e.jsx(j,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"h-5 w-5 bg-green-500 rounded-full"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:o&&m?"Filtered Payments":"Total Payments"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:a(l.total_payments_made||0)})]})]})})}),e.jsx(j,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"h-5 w-5 bg-orange-500 rounded-full"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:o&&m?"Filtered Outstanding":"Outstanding Balance"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:a(l.total_outstanding||0)})]})]})})})]})]}),e.jsxs(j,{children:[e.jsx(R,{children:e.jsx(V,{children:"Credit Transaction History"})}),e.jsxs(y,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Filters"}),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>{const{start:t,end:s}=w();S(t),C(s),u.get(route("suppliers.transactions",l.id),{start_date:t,end_date:s,page:1},{preserveState:!0,preserveScroll:!0,replace:!0})},children:"Clear Filters"})]}),e.jsxs("div",{children:[e.jsxs(g,{className:"text-sm font-medium text-gray-700 mb-2 block",children:["Date Range ",e.jsx("span",{className:"text-xs text-gray-500",children:"(Default: Current Month)"})]}),e.jsx(G,{startDate:D,endDate:P,onChange:B})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(((T=r.data)==null?void 0:T.length)||0)+((c==null?void 0:c.length)||0)," timeline items (transactions + payments)"]})]}),e.jsxs("div",{className:"space-y-4",children:[(()=>{const t=[];return r.data.forEach(s=>{t.push({...s,type:"transaction",sortDate:i(s.transaction_date)||new Date(s.created_at)})}),c.forEach(s=>{r.data.some(n=>{const p=i(s.payment_date)||new Date(s.created_at),N=i(n.transaction_date)||new Date(n.created_at),z=Math.abs(p-N)<6e4,U=parseFloat(s.payment_amount)===parseFloat(n.todays_payments||0);return z&&U&&n.todays_payments>0})||t.push({...s,type:"payment",sortDate:i(s.payment_date)||new Date(s.created_at)})}),t.sort((s,d)=>s.sortDate-d.sortDate),t.map((s,d)=>s.type==="transaction"?e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsx("h3",{className:"text-base font-semibold",children:f(i(s.transaction_date)||new Date(s.created_at))})]}),s.outstanding_balance>0&&e.jsxs("span",{className:"px-2 py-1 text-xs bg-red-100 text-red-700 rounded-full",children:["Outstanding: ",a(s.outstanding_balance)]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>L(s.id),className:"text-red-600",children:[e.jsx(k,{className:"mr-2 h-3 w-3"}),"Delete"]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.description}),s.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.notes})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Items Purchased:"}),s.items&&s.items.length>0?e.jsx("div",{className:"overflow-hidden rounded-md border border-gray-200",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-3 text-left font-medium text-gray-700",children:"Product"}),e.jsx("th",{className:"py-2 px-3 text-right font-medium text-gray-700",children:"Qty"}),e.jsx("th",{className:"py-2 px-3 text-right font-medium text-gray-700",children:"Unit Price"}),e.jsx("th",{className:"py-2 px-3 text-right font-medium text-gray-700",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.items.map((n,p)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-3 text-gray-900",children:n.product_name}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-700",children:n.quantity}),e.jsx("td",{className:"py-2 px-3 text-right text-gray-700",children:a(n.unit_price)}),e.jsx("td",{className:"py-2 px-3 text-right font-medium text-gray-900",children:a(n.total_amount||n.quantity*n.unit_price)})]},n.id||p))})]})}):e.jsx("div",{className:"rounded-md border border-gray-200 bg-gray-50 p-3",children:e.jsx("p",{className:"text-sm text-gray-600 italic",children:"No detailed items recorded for this transaction"})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700",children:"Financial Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Previous Debt:"}),e.jsx("span",{className:"font-medium",children:a(s.previous_debt||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Current Transaction:"}),e.jsx("span",{className:"font-medium text-blue-600",children:a(s.current_debt||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Debt:"}),e.jsx("span",{className:"font-semibold text-red-600",children:a(s.total_debt||0)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Current Payment:"}),e.jsx("span",{className:"font-medium text-green-600",children:a(s.todays_payments||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Outstanding Balance:"}),e.jsx("span",{className:"font-bold text-red-700",children:a(s.outstanding_balance||0)})]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 italic border-t pt-2",children:[e.jsx("span",{className:"font-medium",children:"Flow:"})," Previous debt (",a(s.previous_debt||0),") + New transaction (",a(s.current_debt||0),") = Total debt (",a(s.total_debt||0),"). After current payment: ",a(s.outstanding_balance||0)," outstanding."]})]}),s.todays_payments>0&&e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg space-y-3 mt-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-green-700",children:"Payment Made"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-lg font-semibold text-green-600",children:a(s.todays_payments)}),s.payment_method&&e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded-full",children:s.payment_method})]}),s.payment_notes&&e.jsx("p",{className:"text-xs text-gray-600",children:s.payment_notes})]})]},`transaction-${s.id}`):e.jsxs("div",{className:"rounded-lg border bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("h3",{className:"text-base font-semibold",children:f(i(s.payment_date)||new Date(s.created_at))})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>I(s),className:"text-blue-600",children:[e.jsx(Y,{className:"mr-2 h-3 w-3"}),"Edit"]}),e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>q(s.id),className:"text-red-600",children:[e.jsx(k,{className:"mr-2 h-3 w-3"}),"Delete"]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-600",children:a(s.payment_amount)}),s.payment_method&&e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded-full",children:s.payment_method})]}),s.notes&&e.jsx("p",{className:"text-sm text-gray-600",children:s.notes})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm text-green-700",children:"Payment Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Previous Debt:"}),e.jsx("span",{className:"font-semibold text-red-600",children:a(s.previous_debt||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment Amount:"}),e.jsx("span",{className:"font-semibold text-green-600",children:a(s.payment_amount)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Outstanding Balance:"}),e.jsx("span",{className:"font-bold text-orange-600",children:a(s.outstanding_balance||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payment Method:"}),e.jsx("span",{className:"font-medium",children:s.payment_method||"Not specified"})]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 italic border-t pt-2",children:[e.jsx("span",{className:"font-medium",children:"Flow:"})," Previous debt (",a(s.previous_debt||0),") - Payment (",a(s.payment_amount),") = Outstanding (",a(s.outstanding_balance||0),")"]}),s.notes&&e.jsxs("div",{className:"text-xs text-gray-600 border-t pt-2",children:[e.jsx("span",{className:"font-medium",children:"Notes:"})," ",s.notes]})]})]},`payment-${s.id}`))})(),(()=>{var s;return(((s=r.data)==null?void 0:s.length)||0)+((c==null?void 0:c.length)||0)===0?e.jsx("div",{className:"py-8 text-center text-gray-500",children:"No transactions or payments found for this supplier."}):null})()]}),(r.prev_page_url||r.next_page_url)&&e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-4",children:[r.prev_page_url?e.jsx(F,{href:r.prev_page_url,preserveState:!0,preserveScroll:!0,className:"rounded border px-3 py-1 bg-white hover:bg-gray-100",children:"Previous"}):e.jsx("span",{className:"rounded border px-3 py-1 cursor-not-allowed bg-gray-200",children:"Previous"}),e.jsx("span",{className:"rounded border px-3 py-1",children:r.current_page}),r.next_page_url?e.jsx(F,{href:r.next_page_url,preserveState:!0,preserveScroll:!0,className:"rounded border px-3 py-1 bg-white hover:bg-gray-100",children:"Next"}):e.jsx("span",{className:"rounded border px-3 py-1 cursor-not-allowed bg-gray-200",children:"Next"})]})]})]})]}),O&&h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Edit Payment"}),e.jsx("form",{onSubmit:t=>{t.preventDefault();const s=new FormData(t.target);u.put(route("suppliers.update-payment",h.id),{payment_date:s.get("payment_date"),payment_amount:s.get("payment_amount"),payment_method:s.get("payment_method"),notes:s.get("notes")},{onSuccess:()=>{v(!1),_(null)},preserveScroll:!0,preserveState:!0,only:["supplier","transactions","payments","flash"]})},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"edit_payment_date",children:"Payment Date"}),e.jsx("input",{type:"date",id:"edit_payment_date",name:"payment_date",defaultValue:h.payment_date,className:"w-full border rounded-md px-3 py-2",required:!0})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"edit_payment_amount",children:"Amount"}),e.jsx("input",{type:"number",id:"edit_payment_amount",name:"payment_amount",step:"0.01",min:"0.01",defaultValue:h.payment_amount,className:"w-full border rounded-md px-3 py-2",placeholder:"0.00",required:!0})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"edit_payment_method",children:"Payment Method"}),e.jsxs("select",{id:"edit_payment_method",name:"payment_method",defaultValue:h.payment_method||"",className:"w-full border rounded-md px-3 py-2",children:[e.jsx("option",{value:"",children:"Select method"}),e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),e.jsx("option",{value:"check",children:"Check"}),e.jsx("option",{value:"mobile_money",children:"Mobile Money"})]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"edit_notes",children:"Notes"}),e.jsx("textarea",{id:"edit_notes",name:"notes",rows:"3",defaultValue:h.notes||"",className:"w-full border rounded-md px-3 py-2",placeholder:"Optional notes about this payment"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>{v(!1),_(null)},children:"Cancel"}),e.jsx(x,{type:"submit",children:"Update Payment"})]})]})})]})})]})}export{de as default};
