import{u as H,j as e,r as w,H as se,L as A,a as ae}from"./app-tfx8sgzK.js";import{B as O}from"./badge-DGQG1FrD.js";import{c as U,F as i}from"./createLucideIcon-CYId-Gfo.js";import{C as u,a as g,b,c as y,d as re}from"./card-Cs6X2Lwc.js";import{D as k,a as $,b as L,c as M,d as q,e as R,f as E}from"./dialog-BvKPajzG.js";import{I as h}from"./input-DfuikuvX.js";import{L as d}from"./label-06WqB7MX.js";import{T as de,a as le,b as z,c as x,d as ne,e as m}from"./table-C53pX2su.js";import{T as B}from"./textarea-VlPuqXJG.js";import{P as G}from"./plus-yNdi-fCV.js";import{A as ie,M as ce,S as oe}from"./app-layout-HriqV_-h.js";import{P as xe,M as me}from"./phone-CUILkIm_.js";import{C as he}from"./calendar-DfKXgeq2.js";import{D as pe}from"./dollar-sign-C4zJP4nP.js";import{S as je}from"./square-pen-C3orRbKO.js";import{T as ue}from"./trash-2-Ce6rasxI.js";import"./index-CGEynh0A.js";import"./index-B9fWq91z.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],be=U("ArrowLeft",ge);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Ne=U("FileText",ye);function ve({customer:s,open:l,onOpenChange:N}){const{data:c,setData:p,post:C,processing:v,errors:r,reset:S}=H({amount:"",debt_date:new Date().toISOString().split("T")[0],description:"",notes:""}),j=a=>{a.preventDefault(),C(route("customers.debts.store",s.id),{onSuccess:()=>{N(!1),S()}})};return e.jsxs(k,{open:l,onOpenChange:N,children:[e.jsx($,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"border-red-600 text-red-600 hover:bg-red-50",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Add Debt"]})}),e.jsxs(L,{className:"sm:max-w-[500px]",children:[e.jsxs(M,{children:[e.jsx(q,{children:"Add Debt Record"}),e.jsxs(R,{children:["Record a debt entry for ",s.name,". This can be a previous debt or any outstanding amount."]})]}),e.jsxs("form",{onSubmit:j,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(d,{htmlFor:"amount",children:["Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"amount",type:"number",step:"0.01",min:"0.01",value:c.amount,onChange:a=>p("amount",a.target.value),placeholder:"0.00",required:!0}),r.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.amount})]}),e.jsxs("div",{children:[e.jsxs(d,{htmlFor:"debt_date",children:["Debt Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"debt_date",type:"date",value:c.debt_date,onChange:a=>p("debt_date",a.target.value),required:!0}),r.debt_date&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.debt_date})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"description",children:"Description"}),e.jsx(h,{id:"description",type:"text",value:c.description,onChange:a=>p("description",a.target.value),placeholder:"Brief description of the debt...",maxLength:500}),r.description&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.description})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"notes",children:"Additional Notes"}),e.jsx(B,{id:"notes",value:c.notes,onChange:a=>p("notes",a.target.value),placeholder:"Any additional notes or details...",rows:3,maxLength:1e3}),r.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.notes})]})]}),e.jsxs(E,{className:"mt-6",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>N(!1),disabled:v,children:"Cancel"}),e.jsx(i,{type:"submit",disabled:v,className:"bg-red-600 hover:bg-red-700",children:v?"Adding...":"Add Debt"})]})]})]})]})}function Ie({customer:s,transactions:l}){const[N,c]=w.useState(!1),[p,C]=w.useState(!1),[v,r]=w.useState(null),[S,j]=w.useState(!1),{data:a,setData:T,post:V,processing:I,errors:_,reset:Z}=H({amount_collected:"",payment_date:new Date().toISOString().split("T")[0],notes:""}),{data:D,setData:f,put:J,processing:F,errors:o,reset:K}=H({amount:"",debt_date:"",description:"",notes:""}),Q=t=>{t.preventDefault(),V(route("customers.payments.store",s.id),{onSuccess:()=>{c(!1),Z()}})},W=t=>{r(t),f({amount:t.debt_amount,debt_date:t.date,description:t.description,notes:t.notes||""}),j(!0)},X=t=>{t.preventDefault(),J(route("customers.debts.update",[s.id,v.debt_record_id]),{onSuccess:()=>{j(!1),K(),r(null)}})},Y=t=>{confirm("Are you sure you want to delete this debt record? This will affect all subsequent balance calculations.")&&ae.delete(route("customers.debts.destroy",[s.id,t.debt_record_id]),{preserveScroll:!0})},ee=t=>{switch(t){case"paid":return"bg-green-100 text-green-800";case"current":return"bg-blue-100 text-blue-800";case"overdue_30":return"bg-yellow-100 text-yellow-800";case"overdue_60":return"bg-orange-100 text-orange-800";case"overdue_90":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},n=t=>new Intl.NumberFormat("en-GH",{style:"currency",currency:"GHS"}).format(t);return e.jsxs(ie,{children:[e.jsx(se,{title:`${s.name} - Transaction History`}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(A,{href:route("customers.index"),className:"mb-4 inline-flex items-center text-sm text-gray-600 hover:text-gray-900",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Back to Customers"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s.name}),e.jsx("p",{className:"mt-1 text-gray-600",children:"Transaction History & Debt Management"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ve,{customer:s,open:p,onOpenChange:C}),e.jsxs(k,{open:N,onOpenChange:c,children:[e.jsx($,{asChild:!0,children:e.jsxs(i,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Record Payment"]})}),e.jsxs(L,{children:[e.jsxs(M,{children:[e.jsx(q,{children:"Record Payment"}),e.jsxs(R,{children:["Record a payment from ",s.name," against their outstanding debt."]})]}),e.jsx("div",{className:"rounded-lg border border-orange-200 bg-orange-50 p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Outstanding Debt:"}),e.jsx("span",{className:"text-xl font-bold text-orange-600",children:n(s.outstanding_balance)})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Total Debt:"}),e.jsx("span",{className:"font-medium text-gray-900",children:n(s.total_debt)})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Paid So Far:"}),e.jsx("span",{className:"font-medium text-green-600",children:n(s.total_payments)})]})]})}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"amount_collected",children:"Amount Collected"}),e.jsx(h,{id:"amount_collected",type:"number",step:"0.01",value:a.amount_collected,onChange:t=>T("amount_collected",t.target.value),placeholder:"0.00",required:!0}),_.amount_collected&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:_.amount_collected})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"payment_date",children:"Payment Date"}),e.jsx(h,{id:"payment_date",type:"date",value:a.payment_date,onChange:t=>T("payment_date",t.target.value),required:!0}),_.payment_date&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:_.payment_date})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"notes",children:"Notes (Optional)"}),e.jsx(B,{id:"notes",value:a.notes,onChange:t=>T("notes",t.target.value),placeholder:"Payment notes...",rows:3})]})]}),e.jsxs(E,{className:"mt-6",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsx(i,{type:"submit",disabled:I,children:I?"Recording...":"Record Payment"})]})]})]})]})]})]})]}),e.jsxs("div",{className:"mb-8 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(u,{children:[e.jsx(g,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-gray-600",children:"Total Debt"})}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:n(s.total_debt)})})]}),e.jsxs(u,{children:[e.jsx(g,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-gray-600",children:"Outstanding Balance"})}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:n(s.outstanding_balance)})})]}),e.jsxs(u,{children:[e.jsx(g,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-gray-600",children:"Total Payments"})}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:n(s.total_payments)})})]}),e.jsxs(u,{children:[e.jsx(g,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-gray-600",children:"Status"})}),e.jsx(y,{children:e.jsx(O,{className:ee(s.outstanding_balance>0?"overdue_30":"paid"),children:s.outstanding_balance>0?"Has Outstanding Debt":"Paid Up"})})]})]}),e.jsxs(u,{className:"mb-8",children:[e.jsx(g,{children:e.jsx(b,{children:"Customer Information"})}),e.jsx(y,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:s.phone||"No phone number"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(me,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:s.email||"No email address"})]}),s.address&&e.jsxs("div",{className:"flex items-start space-x-2 md:col-span-2",children:[e.jsx(ce,{className:"mt-0.5 h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:s.address})]})]})})]}),e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(b,{children:"Transaction History"}),e.jsx(re,{children:"Complete history of debt transactions and payments"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(de,{children:[e.jsx(le,{children:e.jsxs(z,{children:[e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Type"}),e.jsx(x,{children:"Reference"}),e.jsx(x,{children:"Description"}),e.jsx(x,{className:"text-right",children:"Debt Amount"}),e.jsx(x,{className:"text-right",children:"Payment Amount"}),e.jsx(x,{className:"text-right",children:"Balance"}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsx(ne,{children:l.data.map(t=>e.jsxs(z,{children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:t.date})]})}),e.jsx(m,{children:e.jsx(O,{className:`capitalize ${t.type==="debt"||t.type==="historical_debt"?"bg-red-600 text-white hover:bg-red-700":"bg-green-600 text-white hover:bg-green-700"}`,children:t.type==="debt"?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"mr-1 h-3 w-3"}),"Debt"]}):t.type==="historical_debt"?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"mr-1 h-3 w-3"}),"Historical Debt"]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"mr-1 h-3 w-3"}),"Payment"]})})}),e.jsx(m,{className:"font-mono text-sm",children:t.reference}),e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.description}),t.notes&&e.jsx("div",{className:"mt-1 text-sm text-gray-500",children:t.notes}),t.sale_items&&t.sale_items.length>0&&e.jsx("div",{className:"mt-1 text-sm text-gray-600",children:t.sale_items.map((P,te)=>e.jsxs("div",{children:[P.product," - ",P.quantity," @ ",n(P.unit_price)]},te))})]})}),e.jsx(m,{className:"text-right",children:t.debt_amount>0?e.jsxs("span",{className:"font-medium text-red-600",children:["+",n(t.debt_amount)]}):e.jsx("span",{className:"text-gray-500",children:"-"})}),e.jsx(m,{className:"text-right",children:t.payment_amount>0?e.jsxs("span",{className:"font-medium text-green-600",children:["-",n(t.payment_amount)]}):e.jsx("span",{className:"text-gray-500",children:"-"})}),e.jsx(m,{className:"text-right",children:e.jsx("span",{className:`font-bold ${t.current_balance>0?"text-red-600":"text-green-600"}`,children:n(t.current_balance)})}),e.jsx(m,{className:"text-right",children:t.type==="historical_debt"&&e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>W(t),className:"text-blue-600 hover:text-blue-700",children:e.jsx(je,{className:"h-3 w-3"})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>Y(t),className:"text-red-600 hover:text-red-700",children:e.jsx(ue,{className:"h-3 w-3"})})]})})]},t.id))})]})}),(l.prev_page_url||l.next_page_url)&&e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-4",children:[l.prev_page_url?e.jsx(A,{href:l.prev_page_url,preserveState:!0,preserveScroll:!0,className:"rounded border bg-white px-3 py-1 hover:bg-gray-100",children:"Previous"}):e.jsx("span",{className:"cursor-not-allowed rounded border bg-gray-200 px-3 py-1",children:"Previous"}),e.jsx("span",{className:"rounded border px-3 py-1",children:l.current_page}),l.next_page_url?e.jsx(A,{href:l.next_page_url,preserveState:!0,preserveScroll:!0,className:"rounded border bg-white px-3 py-1 hover:bg-gray-100",children:"Next"}):e.jsx("span",{className:"cursor-not-allowed rounded border bg-gray-200 px-3 py-1",children:"Next"})]})]})]}),e.jsx(k,{open:S,onOpenChange:j,children:e.jsxs(L,{children:[e.jsxs(M,{children:[e.jsx(q,{children:"Edit Debt Record"}),e.jsx(R,{children:"Update the debt record details."})]}),e.jsxs("form",{onSubmit:X,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(d,{htmlFor:"edit_amount",children:["Amount ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"edit_amount",type:"number",step:"0.01",min:"0.01",value:D.amount,onChange:t=>f("amount",t.target.value),required:!0}),o.amount&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.amount})]}),e.jsxs("div",{children:[e.jsxs(d,{htmlFor:"edit_debt_date",children:["Debt Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"edit_debt_date",type:"date",value:D.debt_date,onChange:t=>f("debt_date",t.target.value),required:!0}),o.debt_date&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.debt_date})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_description",children:"Description"}),e.jsx(h,{id:"edit_description",type:"text",value:D.description,onChange:t=>f("description",t.target.value),maxLength:500}),o.description&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.description})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit_notes",children:"Additional Notes"}),e.jsx(B,{id:"edit_notes",value:D.notes,onChange:t=>f("notes",t.target.value),rows:3,maxLength:1e3}),o.notes&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.notes})]})]}),e.jsxs(E,{className:"mt-6",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>j(!1),disabled:F,children:"Cancel"}),e.jsx(i,{type:"submit",disabled:F,className:"bg-blue-600 hover:bg-blue-700",children:F?"Updating...":"Update Debt"})]})]})]})})]})})]})}export{Ie as default};
