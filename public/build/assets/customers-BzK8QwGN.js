import{b as W,r as t,u as Y,a as f,j as e}from"./app-CJAfpu_B.js";import{C as Z}from"./ConfirmArchiveModal-D6yrxql8.js";import{F as o}from"./createLucideIcon-Cg7ANiR-.js";import{C as N,a as v,b as C,c as b}from"./card-CqjrLppC.js";import{D,a as ee,b as X,c as A,d as E}from"./dialog-CAA-wllh.js";import{I as d}from"./input-Dk-R2vtg.js";import{L as r}from"./label-Bg7Q41yp.js";import{T as se,a as ae,b as M,c,d as te,e as m}from"./table-GVnBoJML.js";import{T as _}from"./textarea-B8GjicWn.js";import{A as le,U as H,e as re,M as ne}from"./app-layout-BYjCDRLU.js";import{l as ie,S as de}from"./lodash-Cw5MRD_J.js";import{P as oe}from"./plus-BdnMlgTQ.js";import{P as ce,M as me}from"./phone-D_Yihe_F.js";import{T as xe}from"./triangle-alert-Ds5pzo1R.js";import{H as he}from"./history-Bbfn3-5z.js";import{S as ue}from"./square-pen-BFRhAgDe.js";import{T as pe}from"./trash-2-DWws5xuW.js";import"./index-Ca9tWU42.js";import"./index-Dqg2lGr_.js";import"./index-CzC18CvF.js";function Ie(){const{customers:x=[],filters:O={}}=W().props,[P,u]=t.useState(!1),[I,y]=t.useState(null),{data:l,setData:a,post:k,put:G,processing:S,errors:je,reset:w}=Y({name:"",phone:"",email:"",address:""}),[q,p]=t.useState(!1),[h,B]=t.useState(O.search||""),[L,j]=t.useState(!1),[n,g]=t.useState(null),[U,T]=t.useState(!1),F=t.useCallback(ie.debounce(s=>{f.get(route("customers.index"),{search:s||void 0},{preserveState:!0,preserveScroll:!0,replace:!0})},400),[]);t.useEffect(()=>{F(h)},[h,F]);const z=[{title:"Customers",href:"/customers"}];function R(s){s.preventDefault(),k(route("customers.store"),{onSuccess:()=>{w(),p(!1)}})}function $(s){y(s),a({name:s.name,phone:s.phone||"",email:s.email||"",address:s.address||""}),u(!0)}function J(s){s.preventDefault(),G(route("customers.update",I.id),{onSuccess:()=>{w(),u(!1),y(null)},preserveScroll:!0,preserveState:!0,only:["customers","errors","flash"]})}function K(s){g(s),j(!0)}function Q(){n&&(T(!0),f.delete(route("customers.destroy",n.id),{preserveScroll:!0,preserveState:!0,only:["customers","flash"],onFinish:()=>{T(!1),j(!1),g(null)}}))}function V(s){const i=[];return s.sales_count>0&&i.push(`${s.sales_count} sales`),s.debts_count>0&&i.push(`${s.debts_count} debts`),s.outstanding_balance>0&&i.push(`GHC ${s.outstanding_balance.toLocaleString()} outstanding`),i.length>0?i.join(", "):null}return e.jsxs(le,{breadcrumbs:z,children:[e.jsxs("div",{className:"min-h-screen space-y-6 bg-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Customers"}),e.jsxs(D,{open:q,onOpenChange:p,children:[e.jsx(ee,{asChild:!0,children:e.jsxs(o,{onClick:()=>p(!0),children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Add Customer"]})}),e.jsxs(X,{className:"max-w-2xl",children:[e.jsx(A,{children:e.jsx(E,{children:"Add New Customer"})}),e.jsxs("form",{onSubmit:R,className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"customer-name",className:"text-right",children:"Customer Name"}),e.jsx(d,{id:"customer-name",className:"col-span-3",placeholder:"Enter customer name",value:l.name,onChange:s=>a("name",s.target.value),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"phone",className:"text-right",children:"Phone"}),e.jsx(d,{id:"phone",className:"col-span-3",placeholder:"+233 XX XXX XXXX",value:l.phone,onChange:s=>a("phone",s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(d,{id:"email",type:"email",className:"col-span-3",placeholder:"customer@email.com",value:l.email,onChange:s=>a("email",s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"address",className:"text-right",children:"Address"}),e.jsx(_,{id:"address",className:"col-span-3",placeholder:"Customer address",value:l.address,onChange:s=>a("address",s.target.value)})]}),e.jsx(o,{type:"submit",disabled:S,children:"Add Customer"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-4",children:[e.jsxs(N,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Total Customers"}),e.jsx(H,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.length}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Active customers"})]})]}),e.jsxs(N,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Outstanding Balance"}),e.jsx(re,{className:"h-4 w-4 text-orange-600"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["GH₵",x.reduce((s,i)=>s+parseFloat(i.outstanding_balance),0).toFixed(2)]}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Total owed"})]})]})]}),e.jsxs(N,{children:[e.jsxs(v,{children:[e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Customer Directory"]}),e.jsx("div",{className:"mt-4 flex items-center space-x-2",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(de,{className:"text-muted-foreground absolute top-2.5 left-2 h-4 w-4"}),e.jsx(d,{placeholder:"Search by name, phone, email, or address...",value:h,onChange:s=>B(s.target.value),className:"pl-8"})]})})]}),e.jsxs(b,{children:[e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(M,{children:[e.jsx(c,{children:"Customer Name"}),e.jsx(c,{children:"Contact Info"}),e.jsx(c,{children:"Address"}),e.jsx(c,{children:"Outstanding Balance"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(te,{children:x.map(s=>e.jsxs(M,{children:[e.jsx(m,{className:"font-medium",children:s.name}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(ce,{className:"h-3 w-3"}),s.phone]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(me,{className:"h-3 w-3"}),s.email]})]})}),e.jsx(m,{className:"max-w-xs",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(ne,{className:"h-3 w-3"}),s.address]})}),e.jsx(m,{className:"font-medium",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:s.outstanding_balance>0?"text-red-600 font-bold":"text-green-600 font-bold",children:["GH₵",parseFloat(s.outstanding_balance).toFixed(2)]}),s.has_outstanding_debt&&e.jsx(xe,{className:"h-4 w-4 text-red-500"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Total Debt: GH₵",parseFloat(s.total_debt).toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Total Payments: GH₵",parseFloat(s.total_payments).toFixed(2)]})]})}),e.jsx(m,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>f.visit(route("customers.transactions",s.id)),className:"text-blue-600 hover:text-blue-700",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>$(s),children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>K(s),children:e.jsx(pe,{className:"h-4 w-4"})})]})})]},s.id))})]}),x.length===0&&e.jsx("div",{className:"text-muted-foreground py-8 text-center",children:h?"No customers found matching your search.":"No customers found."})]})]})]}),e.jsx(D,{open:P,onOpenChange:u,children:e.jsxs(X,{className:"max-w-2xl",children:[e.jsx(A,{children:e.jsx(E,{children:"Edit Customer"})}),e.jsxs("form",{onSubmit:J,className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"edit-customer-name",className:"text-right",children:"Customer Name"}),e.jsx(d,{id:"edit-customer-name",className:"col-span-3",placeholder:"Enter customer name",value:l.name,onChange:s=>a("name",s.target.value),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"edit-phone",className:"text-right",children:"Phone"}),e.jsx(d,{id:"edit-phone",className:"col-span-3",placeholder:"+233 XX XXX XXXX",value:l.phone,onChange:s=>a("phone",s.target.value),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"edit-email",className:"text-right",children:"Email"}),e.jsx(d,{id:"edit-email",type:"email",className:"col-span-3",placeholder:"customer@email.com",value:l.email,onChange:s=>a("email",s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"edit-address",className:"text-right",children:"Address"}),e.jsx(_,{id:"edit-address",className:"col-span-3",placeholder:"Customer address",value:l.address,onChange:s=>a("address",s.target.value)})]}),e.jsx(o,{type:"submit",disabled:S,children:"Update Customer"})]})]})}),e.jsx(Z,{isOpen:L,onClose:()=>{j(!1),g(null)},onConfirm:Q,title:"Delete Customer",itemName:n==null?void 0:n.name,relatedDataMessage:n?V(n):null,isProcessing:U})]})}export{Ie as default};
